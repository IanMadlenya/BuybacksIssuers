
<< Data loading and recalculation, eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=
#rm(list=ls()) # Clean up the memory, if we want to rerun from scratch
#dev.off();
#library(knitr); knit2pdf('report.Rnw', texi2dvi='texi2dvi'); file.remove(paste("report",c(".aux",".tex",".blg",".bbl",".log",".out"),sep=""))
#dir.create("tmpfiles") # need to comment this if the directory already exists

#Timing: 
require(tictoc)
tic() #without report_tool.R: 77s
###################################################
## SAME AS bb_issuers.Rnw
reload_data = 1

# Then to make it into Word: 
# pandoc -s bb_issuers.tex --bibliography=bibliography.bib --number-sections --reference-links -o theo.docx

generate_all_data = 0 # set this to 1 if the data need to be re-generated from the csv's even though they already exist as .Rdata. 
# TIME ALIGNMENT IS KEY, SO WE HAVE A SEPARATE PART OF THE CODE FOR THIS
time_align_all_data = 0
# Some basic data generation that we need across events
rerun_buyback_data_code <- 0
rerun_issuers_data_code <- 0
# If we generate the cross-events data again
get_crossevent_data <- 0 # Old stuff, not used for now
# report_code is only customized to change the "high U-index" and "low U-index" companies, nothing else. Everything else is done in report_data.R
rerun_buyback_report_code <- 0
rerun_issuers_report_code <- 0
# All the RNW data
generate_rnw_data = 0

source("lib_helpers.R",local=environment())
source("latex_code.R",local=environment())
source("dataset/indices_and_factors/ff_industries_sic.R",local=environment())
source("business_data_clean.R",local=environment())
source("Paper_global_parameters.R",local=environment())

if (generate_rnw_data == 1){
  source("bb_issuers.R",local=environment())
}  else{
  if (reload_data)
    load(normalizePath("bb_issuersTOOL.Rdata"))
  source("lib_helpers.R",local=environment()) 
  source("latex_code.R",local=environment())
  source("dataset/indices_and_factors/ff_industries_sic.R",local=environment())
  source("business_data_clean.R",local=environment())
  source("Paper_global_parameters.R",local=environment())
}

firstyear = as.character(format(FirstTrade,"%Y"))
lastyear = as.character(format(Last,"%Y"))

# use comma for 1000s
knit_hooks$set(inline = function(x) {
  if(is.numeric(x)){
    return(prettyNum(x, big.mark=","))
  }else{
    return(x)
  }
})

########################################################################################################
## REPORT.RNW SPECIAL CODE:
########################################################################################################

#Add any/all choices made in the tool here
if(!exists("input") ){#& FALSE
  input = list()
  input$startdate <- as.Date("1984-12-31")
  input$enddate <- as.Date("2014-12-31")
  market_cap_min = "10"
  market_cap_max = "10000"
  quantile_used_ind = "0.2"
  quantile_used_all = "0.4"
  
  #for extra sections
  input$characteristic_irats1 <- "BE.ME.Score"
  input$characteristic_irats1_sign <- T
  
  input$characteristic_irats2 <- "pre.vol.Score"
  input$characteristic_irats2_sign <- T
}
market_cap_min = as.numeric(input$market_cap_min)
market_cap_max = as.numeric(input$market_cap_max)
quantile_used_ind = as.numeric(input$quantile_used_ind)
quantile_used_all = as.numeric(input$quantile_used_all)

#need to add environment here because this is called from Rmd
options(warn=-1) #because some period don't have data
source("report_helpers.R",local=environment()) 
source("report_tool.R",local=environment())
source("report_tool_section.R",local=environment())
options(warn=0)


#Now overwrite any variables that need redefining
firstyear = as.character(format(input$startdate,"%Y"))
lastyear = as.character(format(input$enddate,"%Y"))
FirstTrade = input$startdate

@

%<<  Data loading, eval = TRUE,
\documentclass[12pt]{article}

% DEFAULT PACKAGE SETUP
\usepackage{setspace,graphicx,epstopdf,amsmath,amsfonts,amssymb,amsthm,versionPO}
\usepackage{marginnote,datetime,enumitem,subfigure,rotating,fancyvrb,graphics,siunitx}
\usepackage{capt-of,pdflscape}
\usepackage{hyperref,float}
\usepackage[longnamesfirst]{natbib}
\usepackage{booktabs}% http://ctan.org/pkg/booktabs

\usdate

%\usepackage[dvipsnames]{xcolor} % Refer to colors by name
%\usepackage[colorlinks=true,urlcolor=blue,linkcolor=Green,citecolor=RedViolet]{hyperref}           
%\usepackage{xcolor}
%\usepackage{colortbl}
%\usepackage{changepage}
%\usepackage{adjustbox}
%\usepackage{multirow}
%\usepackage{longtable}

% These next lines allow including or excluding different versions of text
% using versionPO.sty

\excludeversion{notes}  	% Include notes?
\includeversion{links}          % Turn hyperlinks on?

% Turn off hyperlinking if links is excluded
\iflinks{}{\hypersetup{draft=true}}

% Notes options
\ifnotes{%
\usepackage[margin=1in,paperwidth=10in,right=2.5in]{geometry}%
\usepackage[textwidth=1.4in,shadow,colorinlistoftodos]{todonotes}%
}{%
\usepackage[margin=1in]{geometry}%
\usepackage[disable]{todonotes}%
}

% Allow todonotes inside footnotes without blowing up LaTeX
% Next command works but now notes can overlap. Instead, we'll define 
% a special footnote note command that performs this redefinition.
%\renewcommand{\marginpar}{\marginnote}%

% Save original definition of \marginpar
\let\oldmarginpar\marginpar

% Workaround for todonotes problem with natbib (To Do list title comes out wrong)
\makeatletter\let\chapter\@undefined\makeatother % Undefine \chapter for todonotes

% Define note commands
\newcommand{\smalltodo}[2][] {\todo[caption={#2}, size=\scriptsize, fancyline, #1] {\begin{spacing}{.5}#2\end{spacing}}}
\newcommand{\rhs}[2][]{\smalltodo[color=green!30,#1]{{\bf RS:} #2}}
\newcommand{\rhsnolist}[2][]{\smalltodo[nolist,color=green!30,#1]{{\bf RS:} #2}}
\newcommand{\rhsfn}[2][]{%  To be used in footnotes (and in floats)
\renewcommand{\marginpar}{\marginnote}%
\smalltodo[color=green!30,#1]{{\bf RS:} #2}%
\renewcommand{\marginpar}{\oldmarginpar}}
%\newcommand{\textnote}[1]{\ifnotes{{\noindent\color{red}#1}}{}}
\newcommand{\textnote}[1]{\ifnotes{{\colorbox{yellow}{{\color{red}#1}}}}{}}

% Command to start a new page, starting on odd-numbered page if twoside option 
% is selected above
\newcommand{\clearRHS}{\clearpage\thispagestyle{empty}\cleardoublepage\thispagestyle{plain}}

% Number paragraphs and subparagraphs and include them in TOC
\setcounter{tocdepth}{2}

% JFE-specific includes:

\usepackage{indentfirst} % Indent first sentence of a new section.
\usepackage{jfe}          % JFE-specific formatting of sections, etc.
\usepackage[labelfont=bf]{caption} % bold captions

\newtheorem{theorem}{Theorem}[section]
\newtheorem{assumption}{Assumption}[section]
\newtheorem{proposition}{Proposition}
\newtheorem{conjecture}{Conjecture}
\newtheorem{lemma}{Lemma}[section]
\newtheorem{corollary}{Corollary}
\newtheorem{condition}{Condition}

\begin{document}
%\SweaveOpts{concordance=TRUE}

%%Blind title page
%\begin{titlepage}
%\begin{center}
%  \centering
%\vskip 60pt
%\LARGE Share Buyback and Equity Issue Anomalies Revisited \par
%\vskip 1.5em
%\normalsize  \today
%\noindent \\ 
%\begin{abstract}
%\noindent We re-examine the behavior of stock returns after net issue  announcements using the five-factor model proposed by Fama and French (2015a). We confirm their findings that the equity issue anomaly disappears  with the five-factor model, but the buyback anomaly does not.. Buyback announcements by firms  with high pre-announcement (idiosyncratic) volatility  are followed by higher long-term abnormal returns. This is inconsistent with the widely documented low volatility anomaly, but consistent with Stambaugh, Yu, and Yuan (2015) who find a positive relation between stock returns and idiosyncratic volatility for undervalued stocks.
%\end{abstract}
%\vspace{2cm}
%\end{center}
%\medskip
%\noindent \textit{JEL classification}: G35
%\medskip
%\noindent \textit{Keywords}: Share Buybacks, Seasoned Equity Offerings
%\end{titlepage}

\setlist{noitemsep}  % Reduce space between list items (itemize, enumerate, etc.)
%\onehalfspacing      % Use 1.5 spacing
% Use endnotes instead of footnotes - redefine \footnote command

\title{Share Buyback and Equity Issue Anomalies Revisited}%\footnotetext{}

\author{Theodoros Evgeniou$^*$, Enric Junqu\'e de Fortuny$^*$,\\
Nick Nassuphis$^{**}$, and Theo Vermaelen\thanks{INSEAD, Bd de Constance, 77300 Fontainebleau, France, phone: +33(0)1 6072 4000, $^{**}$31, St. Martin's Lane WC2N 4ER London, United Kingdom, e-mail:   \href{mailto:theodoros.evgeniou@insead.edu}{theodoros.evgeniou@insead.edu}, \href{mailto:enric.junquedefortuny@insead.edu}{enric.junquedefortuny@insead.edu},  \href{mailto:nicknassuphis@gmail.com}{nicknassuphis@gmail.com}, and \href{mailto:theo.vermaelen@insead.edu}{theo.vermaelen@insead.edu}. }}

\date{\today}              % No date for final submission

% Create title page with no page number

\renewcommand{\thefootnote}{\fnsymbol{footnote}}

\singlespacing

\maketitle

\vspace{-.2in}
\begin{abstract}
\noindent We re-examine the behavior of stock returns after net issue  announcements using the five-factor model proposed by Fama and French (2015a). We confirm their findings that the equity issue anomaly disappears  with the five-factor model, but the buyback anomaly does not. Buyback announcements by firms  with high pre-announcement (idiosyncratic) volatility  are followed by higher long-term abnormal returns. This is inconsistent with the widely documented low volatility anomaly, but consistent with Stambaugh, Yu, and Yuan (2015) who find a positive relation between stock returns and idiosyncratic volatility for undervalued stocks.


\end{abstract}
\vspace{2cm}

\medskip

\noindent \textit{JEL classification}: G35

\medskip
\noindent \textit{Keywords}: Share Buybacks, Seasoned Equity Offerings

\thispagestyle{empty}

\clearpage

\onehalfspacing
\setcounter{footnote}{0}
\renewcommand{\thefootnote}{\arabic{footnote}}
\setcounter{page}{1}

\doublespacing

\section{Introduction}
\label{sec:Introduction}


The fact that companies experience long-term positive excess returns after share buybacks and negative long term excess returns after equity issues, has been documented extensively in the academic literature.\footnote{For evidence on long-term excess returns after buybacks see e.g., \cite{IkenberryLakonishokVermaelen1995,PeyerVermaelen2009,ManconiPeyerVermaelen2015}. For evidence  on under-performance after equity issues see e.g., \cite{LoughranRitter1995,SpiessAffleckGraves1995,Eckboetal2000,DittmarThakor2007,Bravetal2000}.}  In spite of these well documented anomalies investors are not less excited today about e.g., a buyback announcement than 30 years ago: on average stock prices increase by approximately 2 to 3$\%$ when companies announce that the board of directors has approved a buyback program. Moreover, we find very few funds that specialize in exploiting these anomalies.\footnote{  For example, a Google search for ``buyback funds'' gives very few results: Powershare Buyback Achievers fund, KBC Buyback America, S\&P 500 Buyback ETF, Catalyst/Equity Compass Buyback Strategy fund, and PV Buyback USA. The first 3 funds focus on large caps after buyback completions although the academic research shows abnormal returns are more significant in small, under-priced, value stocks and the relevant event is not the completion of the buyback but the buyback authorization. We are also not aware of event-driven hedge funds that buy repurchasing firms and short equity issuers; typical event-driven strategies are for example based on M\&A arbitrage, capital structure arbitrage or on investing in distressed securities.} The fact that these anomalies have not generated a significant response from investors and asset management firms is somewhat surprising considering that other anomalies have disappeared after being documented in academic research~\citep{McLean2015}. What makes these capital structure anomalies different so that they stand the test of time?

One straightforward explanation is that they are not really anomalous returns but compensation for risk. Excess returns in previous research are calculated using the \cite{FamaFrench1993} three-factor model or the Carhart (1997) 4-factor model as benchmarks. However, \cite{FamaFrench2015b} argue that the buyback and equity issue anomalies do not survive after using the more recent \cite{FamaFrench2015a} five-factor asset pricing model as a model of expected returns. This model incorporates new evidence that profitability and investment patterns, besides market to book and size, explain stock returns (Novy-Marx (2013)). If buybacks (equity issues) are done by firms with high (low) profitability and few (many) investment opportunities, then these factors may well explain the excess returns reported in previous research. Note, however, that \cite{FamaFrench2015b} do not exactly replicate the papers that first reported the anomalies. First, they assume investors buy after the completion of the buyback and the equity issue, not around the announcement date as e.g., \cite{PeyerVermaelen2009}. For buybacks this may be an issue as repurchases may be completed several years after the buyback authorization (Stephens and Weisbach (1998)). Moreover \cite{FamaFrench2015b} do not examine repurchases and equity issues separately: they calculate returns after net equity issues (funds spent on buybacks minus funds spent on equity issues). The part of their sample where net equity issues are positive is defined as the ``buyback sample''. But this sample still contains some equity issuers, which may introduce a downward bias in the excess returns calculations. Moreover the idea of pooling buybacks and equity issues in ``net issues'' assumes that the decision to issue equity is simply the mirror of buying back shares. However, issuing stock to new investors is not the same as buying back stock from ``old'' selling investors. In the first case, the management has to face new shareholders that may face potential losses, while in the second case the firm only takes advantage of selling shareholders who leave the firm. In this paper we re-examine the anomaly using the \cite{FamaFrench2015a} model but use announcement dates and separate buyback announcements and equity announcements.

A second possible reason for the funds' lack of interest in the buyback anomaly is that event studies aggregate returns over a very long horizon. The fact that buying shares after a buyback announcement generates positive excess returns during for example 1990-2014 does not mean that, if one starts a fund in 2016, one can expect to beat the market during the next 3 years. In other words, the anomaly may be time dependent, and investor patience may not extend beyond 3 years. Moreover, because of the growth of institutional investors and the reduction in trading costs markets may have become more efficient in recent years as argued by \cite{FuHuang2015}. The anomaly may also be industry-specific so that an investor who follows a buyback strategy may end up with a highly undiversified portfolio.

The long-term event studies also do not give much guidance about when to sell after a buyback or cover after shorting an equity issue. Trading strategies, such as $M\&A$ arbitrage (\cite{MitchellPulvino2001}), often have ``natural'' exit decision points (e.g., at $M\&A$ deal completion or termination), but the literature does not provide clear guidance about when to exit a buyback position.  Empirical studies tend to show that, on average, excess returns continue for up to 3 or 4 years after a buyback authorization, but there is no reason why such a horizon is optimal. One straightforward ``early'' selling strategy that we study is to combine the buyback and equity issuance anomalies by selling buyback stocks after the firm announces an equity issue. Note that the fact that equity issues in general are followed by negative abnormal returns does not necessarily imply that equity issues after buybacks should generate the same result. 

Finally, the results from event studies which use either Ibbotson RATS or the Calendar Time method estimate excess returns and risks contemporaneously. Investors, such as hedge funds, who would like to exploit the anomaly and hedge market risk need however to estimate the factor betas using historical information. If the buyback signals a change in risk (\cite{GrullonMichaely2004}) hedging market risk may be complicated. That is why in this paper we also simulate hedged investment strategies where we estimate risk {\it before} forming the portfolios.  

The purpose of this paper is to explore these concerns by studying the robustness of the buybacks and issuance anomalies over the 30 year period starting in January \Sexpr{firstyear} and ending in December \Sexpr{lastyear}, using the \cite{FamaFrench2015a} five-factor model. Although there are other models of market equilibrium proposed to explain excess returns after buyback authorizations (i.e. \cite{Linetal2014}) our focus is on the \cite{FamaFrench2015a} challenge.  We confirm the \cite{FamaFrench2015b} conclusion that the five-factor model makes the equity issue anomaly disappear, but the buyback anomaly remains statistically and economically significant. Even though we find that equity issues are not followed by significant negative excess returns in general, it turns out that using a SEO announcement as a sell signal improves the performance of a buyback portfolio. The interpretation is that firms that are timing the market by buying back shares when they are cheap are also successful timing the market when stocks are expensive. We also confirm that the Undervaluation Index developed by \cite{PeyerVermaelen2009} is a good predictor of excess returns, although it emphasizes smaller firms, and that the anomaly does not disappear if we exclude specific industries.

We also test whether the buyback anomaly is related to the even better known {\it low volatility anomaly}: that (idiosyncratic) volatility is negatively related to future returns. For example, \cite{Ang2006} find negative alphas for high volatility and high idiosyncratic volatility stocks, using the 3 factor \cite{FamaFrench1993} model. Moreover, \cite{FamaFrench2015b} show that, using the 5-factor model, this anomaly persists for small firms. However, in our buyback sample we find a significant positive relation between excess returns, using  the Fama-French 5-factor model as a benchmark. This is consistent with the {\it information advantage hypothesis}: in firms with high idiosyncratic risk volatility is largely driven by company-specific information, and for such firms it is more likely that management is better informed than the market. The result is also consistent with \cite{Stambaugh2015} who find a positive relation between stock returns and idiosyncratic volatility for undervalued\footnote{They  define undervaluation on the basis of a combination of 11 return anomalies reported in the literature, including net equity issuance.}  stocks. 

Turning to total volatility we also find that buyback authorizations of high risk stocks are followed by larger excess returns. This is consistent with the {\it option hypothesis}:  a repurchase authorization is an option to take advantage of undervaluation and this option should be more valuable for high volatility stocks (\cite{IkenberryVermaelen1996}). If markets underestimate the value of this option at the time of the buyback authorization, excess returns should be positively correlated with volatility.  Combining idiosyncratic risk and total volatility  with the \cite{PeyerVermaelen2009} Undervaluation Index into an Enhanced Undervaluation Index, improves the predictability of excess returns. In particular, during the four years following the buyback announcement, the high Enhanced Undervaluation Index portfolio generates an excess return of \Sexpr{round(EU_CALtable_bb["+48",13+6],2)}$\%$ per month with the Calendar Time event study method. Using the IRATS method the cumulative excess return reaches \Sexpr{round(EU_IRATStable_bb["+48",19],2)}$\%$ after 48 months. 


This paper is organized as follows. In section 2 we describe our data. In section 3 we test whether buyback and equity issue anomalies survive when we use the \cite{FamaFrench2015a} five-factor model. We also compare firms that buy back stock and issue equity within 48 months of a buyback announcement with firms that do not issue stock subsequently. In section 4 we test whether the buyback anomaly is robust across time, investment horizon and industry. In section 5 we test whether idiosyncratic risk as well as volatility can improve the predictability of excess returns, relative to simply using the Undervaluation Index proposed by \cite{PeyerVermaelen2009}. Section 6 concludes. 


\section{Data}
\label{sec:Data}

Our sample spans the period from January \Sexpr{firstyear} to December \Sexpr{lastyear}. We start in \Sexpr{firstyear} as SDC's coverage is poor before that year. We stop in \Sexpr{lastyear}, the last year all CRSP and Compustat data were available. We retrieved buyback authorization announcements and announcements of Secondary Equity Offerings (SEO's) from the Securities Data Corporation (SDC) database. Daily and monthly returns, pre-announcement daily closing prices and market capitalization data were taken from CRSP. Book value of equity (BE) was taken from Compustat. The Fama-French factors and breakpoints were obtained from Kenneth French's website.

For the buybacks we combined all open market repurchase announcements from both the SDC Repurchases data base and the SDC US mergers and acquisitions ($M\&A$) data base.\footnote{More information is available upon request. An interactive online tool to explore data variations and robustness analyses of all results in this paper is also available upon request.}   We ended up with a total of \Sexpr{cleanup_bb$Standardise$final_merge_data} repurchases events, out of which \Sexpr{cleanup_bb$Standardise$only_repurchase_deals} were only from the SDC Repurchases database, \Sexpr{cleanup_bb$Standardise$only_MA_deals} only from the SDC $M\&A$ database and \Sexpr{cleanup_bb$Standardise$overlap_deals} from both. Finally, we removed the following events: no CRSP returns available (\Sexpr{cleanup_bb$get_crsp$NOPERMNO_remove + cleanup_bb$merge$CRSP_remove} events); not all Compustat data available (\Sexpr{cleanup_bb$compustat$NO_GVKEY_remove + cleanup_bb$merge$compustat_remove} events); the percent of shares authorized was larger than \Sexpr{MAX_EVENT_SIZE}$\%$ (\Sexpr{cleanup_bb$biz_clean$EventSize_filter} events), or the closing price was less than \$\Sexpr{penny_stock_price_old} for events before 1995 or \$\Sexpr{penny_stock_price_recent} for the other (\Sexpr{cleanup_bb$biz_clean$Penny_stock_filter} events), or  the primary stock exchange was not the NYSE, the Nasdaq, or Amex (\Sexpr{cleanup_bb$biz_clean$major_markets_only} events).  Finally, we removed all events from firms in the Financial and Utilities sectors (\Sexpr{length(BUYBACK_DATA_NEW$finance_Size_used)}  events).\footnote{We are using the industries from Kenneth French's Website. The Financial Sector consists of all firms with SIC code at the time of the buyback announcement that belonged in the ``Banks'' or ``Fin'' industries (SIC codes 6000 to 6300 and 6700 to 6799). The Utilities Sector consists of all firms with SIC code 4900 to 4942.}  At the end we are left with \Sexpr{length(cusip_bb)} buyback events made by \Sexpr{length(unique(cusip_bb))} firms. The average percent of share authorized for these firms was \Sexpr{datasummaryBB["Percent authorized", "Mean"]}$\%$ (median of \Sexpr{datasummaryBB["Percent authorized", "Median"]}$\%$), the average Market Capitalization at announcement was \$\Sexpr{datasummaryBB["Market cap.", "Mean"]} Million (median of \$\Sexpr{datasummaryBB["Market cap.", "Median"]} Million), while the BE/ME was on average \Sexpr{datasummaryBB["BE/ME", "Mean"]} (median of \Sexpr{datasummaryBB["BE/ME", "Median"]}).


For the issuers, we started with \Sexpr{cleanup_iss$Standardise$SDC_initial_data} events from SDC, filtered to exclude rights issues, pure secondary offerings where existing shareholders sell shares without generating proceeds for the company,  issues made by non-U.S. firms or in non-U.S. markets, issues made by closed-end funds or unit investment trusts, as well as block trades, accelerated offers and best efforts. We removed all SDC events for which either the event date (\Sexpr{cleanup_iss$Standardise$SDC_NODATE} events) or the CUSIP (\Sexpr{cleanup_iss$Standardise$SDC_NOCUSIP} events) was missing or where we found duplicate events with mismatching information (\Sexpr{cleanup_iss$Standardise$BAD_DUPLICATES} events), a total of \Sexpr{cleanup_iss$Standardise$SDC_standardize_removal} events - given the overlap between these cases. Finally, as for the buybacks, we removed the following events: no CRSP returns available (\Sexpr{cleanup_iss$get_crsp$NOPERMNO_remove + cleanup_iss$merge$CRSP_remove} events); not all Compustat data available (\Sexpr{cleanup_iss$compustat$NO_GVKEY_remove + cleanup_iss$merge$compustat_remove} events); the percent of shares authorized was larger than \Sexpr{MAX_EVENT_SIZE}$\%$ (\Sexpr{cleanup_iss$biz_clean$EventSize_filter} events), or the closing price was less than \$\Sexpr{penny_stock_price_old} for events before 1995 or \$\Sexpr{penny_stock_price_recent} for the other (\Sexpr{cleanup_iss$biz_clean$Penny_stock_filter} events), or  the stocks were not listed on the NYSE, Nasdaq or Amex (\Sexpr{cleanup_iss$biz_clean$major_markets_only} events). We again removed all events from firms in the Financial and Utilities sectors (\Sexpr{length(ISSUERS_DATA$finance_Size_used)} events). Our final sample contains \Sexpr{length(cusip_iss)} issuers events made by \Sexpr{length(unique(cusip_iss))} firms. The average percent of shares issued was \Sexpr{datasummaryISS["Percent authorized", "Mean"]}$\%$ (median of \Sexpr{datasummaryISS["Percent authorized", "Median"]}$\%$), the average Market Capitalization on the announcement day  was \$\Sexpr{datasummaryISS["Market cap.", "Mean"]} Million (median of \$\Sexpr{datasummaryISS["Market cap.", "Median"]} Million), while the BE/ME was on average \Sexpr{datasummaryISS["BE/ME", "Mean"]} (median of \Sexpr{datasummaryISS["BE/ME", "Median"]}).

Figure~\ref{fig:liveevents} shows the number of announcements per year in the sample period as well as the (standardized) level of the $S\&P$ 500. Buyback activity rises prior to stock market increases and tends to fall afterwards, especially during the financial crisis of 2008 when buyback announcements fell to a 15 year low. Note the structural decline in equity issues since 2000.


\section{Share Buybacks, Equity Issues and Abnormal Returns}
\label{sec:PastFindingsBB}

We start with revisiting past research but now using a longer time period and the five-factor model of \cite{FamaFrench2015a} to measure expected returns. In particular, we test whether buyback (equity issue) announcements are followed by significant positive (negative) long term excess returns, and if so, whether the returns can be explained by proxies for undervaluation as proposed by \cite{PeyerVermaelen2009}. 


\subsection{Share buybacks and Equity Issues in Isolation }
\label{sec:AbnormalBuybacks}

Table~\ref{tbl:priorBuybacks}, Panel~A, shows long-term cumulative excess returns for various holding periods after the announcement using the Ibbotson RATS event study method. Each event month~$t$ we run cross-sectional regressions of stock returns against the factors. The intercept in the regression measures the average abnormal excess return in event month~$t$. We then accumulate these excess returns over various time horizons (up to 48 months after the event). The advantage of this method is that each event gets the same weight and that factor betas are allowed to change in event time, something that may be important as capital structure changes may signal a change in risk~\citep{GrullonMichaely2004}. The table compares the excess returns using the \cite{FamaFrench1993} three-factor model and the \cite{FamaFrench2015a} five-factor model. The results show that, although using a five-factor model lowers excess returns, the excess returns are statistically significantly positive over all investment horizons and reach \Sexpr{IRATS_table_all_bb["+48","CAR 5F"]}$\%$ after 4 years (t=\Sexpr{IRATS_table_all_bb["+48",5]}). So the buyback anomaly does not disappear when we use a five-factor model. In all the tables we also calculate cumulative excess returns in the 6 months prior to the buyback. Consistent with past research (e.g., \cite{PeyerVermaelen2009}) buyback authorization announcements are preceded by significant negative excess returns of around \Sexpr{round(IRATS_table_all_bb[reported_times[1],1],0)}$\%$. This is consistent with the hypothesis that the typical repurchase announcement is triggered by at least the perception of insiders that the stock is undervalued.

Table~\ref{tbl:priorIssuers}, Panel~A, shows the results for all equity issues, using the same methodology as in Table~\ref{tbl:priorBuybacks}, Panel~A. Our results are largely consistent with \cite{FamaFrench2015b}. Using the three-factor model, we find statistically significant long term (after 48 months) negative cumulative excess returns of \Sexpr{IRATS_table_all_iss["+48","CAR 3F"]}$\%$ (t=\Sexpr{IRATS_table_all_iss["+48",2]}). However, once we use the five-factor model as a benchmark, excess returns fall and become statistically insignificant after 48 months. This shows that when searching for anomalies, buybacks and equity issues should not be pooled in a ``net issue'' measure. Unlike buybacks, equity issues are firm commitments and announced and completed at the same point in time. Using actual shares issued (the measure used by Fama-French (1995b)) and equity announcements (our measure) should therefore produce similar results. Buyback authorization announcements on the other hand are not firm commitments and are often executed over a long period after the announcement. Actual repurchase dates thus do not correspond to announcement dates. Note also that equity issues are typically preceded by large positive excess returns of around \Sexpr{round(IRATS_table_all_iss[reported_times[1],1],0)}$\%$ in the 6 months prior to the equity issue. However, the lack of post announcement negative excess returns shows that this was not reflecting ``irrational exuberance'' but rather that these firms experienced a substantial increase in growth opportunities and issued equity to finance them. 
One critique of the \cite{ibbotson1975} RATS method is that the result may be time-specific. Indeed as every event is equally weighted the cumulative average abnormal returns are dominated by periods when there are a large number of events. So we also use the Calendar Time method where in each calendar month we form an equally-weighted portfolio of all firms that announce a buyback (or an equity issue) in the previous $t$~months. We then run a time series regression of the portfolio returns against the factors. The intercept of the regression is the average monthly excess return in the $t$~months after the event.

The results in Panel~B of Tables \ref{tbl:priorBuybacks} and  \ref{tbl:priorIssuers} are similar to Panel~A of the same tables. Abnormal returns after buybacks are smaller when the five-factor model is used but remain statistically significant over all horizons. For example, over the 48 month horizon the average monthly excess return is \Sexpr{CAL_table_all_bb["+48","CAL 5F"]}$\%$ (t=\Sexpr{CAL_table_all_bb["+48",5]}) which corresponds to \Sexpr{48*CAL_table_all_bb["+48","CAL 5F"]}$\%$ over 48 months. Note also that excess returns fall when the investment horizon increases. The largest monthly excess return (\Sexpr{CAL_table_all_bb["+1","CAL 5F"]}$\%$) is earned by the portfolio that holds buyback stocks for one month  (not reported in Table \ref{tbl:priorBuybacks})  and the smallest excess return (\Sexpr{CAL_table_all_bb["+48","CAL 5F"]}$\%$) is earned by the portfolio that picks buybacks announced during the previous 48 months. This clearly shows that forming portfolios after buybacks are completed (as is done by measuring net issues in \cite{FamaFrench2015b}) is introducing a downward bias as many repurchase programs are completed several months (sometimes years) after the buyback announcement. Waiting until the buyback is completed means missing the largest excess returns earned shortly after the buyback authorization. Finally, there are no statistically significant excess returns after equity issues, regardless whether we use the three or five-factor model.

Next we test whether the ``Undervaluation Index'' (U-index) developed by \cite{PeyerVermaelen2009} using buyback announcements from 1991 to 2002 is a robust indicator to separate companies that are buying back stock because they are undervalued from companies that repurchase shares for other reasons. We calculate the U-index as follows. Companies get a size score from 1 (large firms) to 5 (small firms) depending on the quantile of their market value of equity in the month prior to the buyback announcement. Then, we calculate the 11-months pre-announcement absolute returns of months -12 to -1 before announcement for all events and assign a score of 5 to the low returns firms and 1 to the high returns ones. Finally, companies get a book value to market value (BE/ME) score depending on the quantile of their BE/ME value of equity in the year prior to the buyback announcement, with a score of 1 to small BE/ME firms and 5 to large ones. Unlike \cite{PeyerVermaelen2009} who use all CRSP companies to define the quantile thresholds, we use the Fama-French breakpoints for prior returns the month before, ME the month before, and BE/ME the year before the event to rank the firms from 1 to 5: for example, firms falling below the $5^{th}$ BE/ME breakpoint are assigned a score of 1, while companies above the $16^{th}$ BE/ME breakpoint are assigned a score of 5.

We sum up these three scores for each firm and we then define as ``high U-index'' the firms with total score more than \Sexpr{quantile(valuation_index_bb,0.8)} and as ``low U-index'' those with total score less than \Sexpr{quantile(valuation_index_bb,0.2)}. Note that unlike \cite{PeyerVermaelen2009} we do not consider the stated reasons for the buyback in the press release, hence we define different thresholds for the high U-index and low U-index buyback firms. We end up with \Sexpr{sum(company_subset_undervalued_bb)} ``high U-index'' buyback stocks (\Sexpr{round(sum(company_subset_undervalued_bb)/length(cusip_bb)*100,2)}\% of all buyback events), and \Sexpr{sum(company_subset_overvalued_bb)} ``low U-index'' ones (\Sexpr{round(sum(company_subset_overvalued_bb)/length(cusip_bb)*100,2)}\% of all buyback events). The distribution of the U-index of all buyback events is shown in Figure~\ref{fig:undervaluationindex}.


Table~\ref{tbl:priorBuybacks}, Panel~A, shows the three-factor as well as the five-factor IRATS for high U-index and low U-index firms. The interesting conclusion is that using the five-factor model improves the predictive power of the U-index: high U-index firms earn 4 year excess returns of \Sexpr{IRATS_table_all_bb_undervaluation["+48","U:CAR5F"]}$\%$ (t=\Sexpr{IRATS_table_all_bb_undervaluation["+48",8]}) while low U-index firms only earn \Sexpr{IRATS_table_all_bb_undervaluation["+48","O:CAR5F"]}$\%$ (t=\Sexpr{IRATS_table_all_bb_undervaluation["+48",11]}), hence \Sexpr{IRATS_table_all_bb_undervaluation["+48","U:CAR5F"] - IRATS_table_all_bb_undervaluation["+48","O:CAR5F"]}$\%$ less than the high U-index ones. Starting from 12 months after the announcement, high U-index firms always beat low U-index firms. When we use the three-factor model, we find similar conclusions, but the results are weaker. For example after 48 months the high U-index firms now earn excess returns of \Sexpr{IRATS_table_all_bb_undervaluation["+48","U:CAR3F"]}$\%$, which is only \Sexpr{IRATS_table_all_bb_undervaluation["+48","U:CAR3F"] - IRATS_table_all_bb_undervaluation["+48","O:CAR3F"]}$\%$ higher than the low-U-index firms. Note that, consistent with \cite{PeyerVermaelen2009} the low U-index buyback stocks earn significant positive excess returns too. It is difficult to find a portfolio of buyback stocks that under-performs in the long run. So the term ``overvaluation'' should be interpreted with caution. The Undervaluation Index is a proxy for the likelihood that the buyback is driven by undervaluation. It does not imply that low U-index firms are overvalued. It means that for these firms the buyback is less likely to be driven by undervaluation, but by other reasons such as managing capital structure, avoiding dilution from executive stock options etc.

Table~\ref{tbl:priorBuybacks}, Panel~B, shows that this conclusion holds when we use the Calendar Time method. Regardless of the horizon, high U-index stocks almost always beat low U-index stocks. As in the case of IRATS, the five-factor model improves the selectivity of the Undervaluation Index: low U-index now no longer earn significant excess returns after 48 months.

Figure~\ref{fig:pastall} summarizes the IRATS results in more detail by showing the cumulative abnormal returns during the 6 month pre and 48 month post event period, using the five-factor model. Results are shown for the total sample of buybacks and equity issues, as well as for high and low U-index buyback samples.


\subsection{Buybacks followed by Equity Issues}
\label{sec:Eventexit}

The results so far show that firms that repurchase shares are good at market timing, in particular the small beaten up value stocks. On the other hand the average equity issuer does not seem to be driven by market timing in general. However, firms that are good at market timing when buying back undervalued stock are perhaps also good at recognizing when their shares are overvalued. Note that successful market timing requires two managerial characteristics: ability to time the market as well as willingness, i.e., accepting the idea that using superior information to benefit long term shareholders at the expense of other shareholders is the ``right'' thing to do.

<<  eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=
SEO_exit_days = sapply(which(BUYBACK_DATA_NEW$DATASET$SDC$Otherlater != "2100-01-01"), function(i) as.Date(BUYBACK_DATA_NEW$DATASET$SDC$Otherlater[i]) - event.date_bb[i])
BB_exit_days = sapply(which(ISSUERS_DATA$DATASET$SDC$Otherlater != "2100-01-01"), function(i) as.Date(ISSUERS_DATA$DATASET$SDC$Otherlater[i]) - event.date_iss[i])
@

During our sample period (\Sexpr{firstyear}-\Sexpr{lastyear}) \Sexpr{length(unique(intersect(cusip_bb,cusip_iss)))} companies in our data set both announced buybacks and issued equity, but in only \Sexpr{length(SEO_exit_days)}  cases a company announced a subsequent equity issue within 4 years after the buyback announcement. We now compute the cumulative excess returns for these firms under two scenarios. First, the ``no exit'' scenario, where we hold the stock for 48 months after the buyback announcement. Second, the ``exit'' scenario, where we sell the shares as soon as the company announces an equity issue.


Of the \Sexpr{length(SEO_exit_days)} such events, \Sexpr{sum(abs(SEO_exit_days) < 1*365)} happen within 1 year from the buyback announcement, \Sexpr{sum(abs(SEO_exit_days) < 2*365)} happen within 2 years and \Sexpr{sum(abs(SEO_exit_days) < 3*365)} happen within 3 years. Note that this grouping of the events is done with hindsight: it is not possible to know at the time of the buyback announcement whether there will be a subsequent SEO or not. We are simply asking the question whether those firms that announced a buyback when they appeared undervalued issued equity when they were overvalued. Figure~\ref{fig:BBISSevents} shows the percentage of repurchasing firms that announced an equity issue within 48 months. The average percentage is \Sexpr{round(mean(BB_with_ISS_later_total),1)}$\%$ and there are only \Sexpr{sum(BB_with_ISS_later_total > 10)} years (1989 and 1990) where the percentage is larger than $10\%$.

Table~\ref{tbl:BBISSexit}  shows that repurchasing firms that issued stock within 48 months after the buyback are remarkable timers. Long-term excess returns after 4 years are \Sexpr{Exit_on_SEO_Abn_table["+48",4]}$\%$ (t=\Sexpr{Exit_on_SEO_Abn_table["+48",5]}), more than four times as large as for the overwhelming majority of firms that do not issue stock subsequently. These results are graphically displayed in Figure~\ref{fig:BBISSexit} (Panel~A). Repurchases by firms that do not issue equity in the next 48 months are followed by long term excess returns of only \Sexpr{Exit_on_SEO_Abn_table["+48",1]}$\%$. One interpretation is that these firms believe they are undervalued but as long as they remain undervalued they do not think it is appropriate to issue stock. 

The Calendar Method results in Panel B of Table~\ref{tbl:BBISSexit} show a relatively large drop of the excess returns over time (e.g., from \Sexpr{Exit_on_SEO_Abn_table_cal["+12",4]}$\%$ after 12 months to \Sexpr{Exit_on_SEO_Abn_table_cal["+48",4]}$\%$ after 48 months) indicating potential benefits of exiting a buyback position when there is a subsequent issue. Figure  \ref{fig:BBISSexit} (Panel~B) shows the benefits of exiting early. The figure shows a strategy with hindsight where, starting in \Sexpr{firstyear}, we invest in an equally weighted portfolio of only firms that announced a buyback and subsequently issued equity within the 48 months after the buyback announcement. The dashed line shows the cumulative excess return if we sold the stock whenever the firm issued shares within 48 months (the exit strategy). The solid line shows the cumulative excess returns if we sold 48 months after the buyback announcement (the no exit case). The investor who had followed the exit strategy would have earned (after 30 years) a cumulative excess return of \Sexpr{round(tail(100*cumsum(BB_ISS_Exit_Hedged),1),1)}$\%$, significantly larger than the \Sexpr{round(tail(100*cumsum(BB_ISS_NoExit_Hedged),1),1)}$\%$ of a buy hold for 48 months strategy. Note, however, that because very few firms that buy back stock issue equity within 48 months,  a strategy ``without hindsight'' where one bought all companies after a buyback and sold only those after a subsequent equity issue would not substantially increase excess returns.

Table~\ref{tbl:BBISSexitAfter} shows the long run excess returns after the announcement of an equity issue for two samples. The first sample (After a Buyback) shows the excess returns for issues for which in the previous 48 months the firm announced a buyback.  The second sample (No Prior Buyback) shows the excess returns for all other issue announcements.  The fact that excess returns are not significantly different from zero for the post-buyback issuers agrees with the intuition of Figure~\ref{fig:BBISSexit}: exiting when there is a subsequent equity issue is the right thing to do for the long-term buyback investor.  


\section{How robust is the buyback  anomaly?}
\label{sec:robust}

The results so far are based on a sample of all buyback and equity announcements over a thirty-year period. As the equity issue anomaly does not survive the \cite{FamaFrench2015a} five-factor model, the remainder of the paper focuses on better understanding the buyback anomaly and uses the five-factor model as a benchmark.\footnote{All analyses below are also done for equity announcements. However, in agreement with the results in Section \ref{sec:AbnormalBuybacks}, we find no consistent/robust results for issuers. All issuers results are available upon request.}  The purpose of this section is to test the robustness of this anomaly: has it become less important over time because markets have become more efficient? How sensitive is it to the length of the investment period? Could the anomaly be industry-specific? 

\subsection{Robustness across time periods and investment horizons}
\label{sec:PastFindingsTime}

Table~\ref{tbl:PastFindingsTimeBB} shows excess returns, using both the IRATS and Calendar Time method for different time periods. We consider time periods, which overlap to some extent with past research (Ikenberry, Lakonishok, and Vermaelen 1995, Peyer and Vermaelen 2009, Manconi, Peyer, and Vermaelen 2015 and Fu and Huang 2015): 1985-1990; 1991-2000; 2001-2014 and 2008-2014. The last period was chosen to incorporate the financial crisis and to test whether indeed markets have become more efficient in recent years, or whether managers have been discouraged from market timing by the obvious mistakes that were made by buying back shares before a major financial crisis.

Table~\ref{tbl:PastFindingsTimeBB} shows that, regardless of the time period chosen or the method to calculate excess returns, the buyback anomaly remains economically and statistically significant and there is no clear time trend in the data that suggests that markets have become more efficient over time. For example, although the 2001-2014 period shows smaller timing ability than the 1990-2000 period, excess returns in the 2008-2014 period are as large as in 1991-2000 period: approximately \Sexpr{BBtable_time["+48",22]}$\%$  after 4 years using IRATS or \Sexpr{BBtable_time_cal["+48",22]}$\%$ per month (\Sexpr{48*BBtable_time_cal["+48",22]}$\%$ after 4 years) when we use the Calendar Time method. There is one exception to the consistency between the IRATS and the Calendar Time results: in the period of 1991-2000, the IRATS method generates excess returns after 48 months of \Sexpr{BBtable_time["+48",10]}$\%$ (t=\Sexpr{BBtable_time["+48",11]}) but the Calendar Time method produces statistically insignificant excess returns of \Sexpr{BBtable_time_cal["+48",10]}$\%$ per month. This result appears to also be inconsistent with \cite{PeyerVermaelen2009}. However, if one includes the financial sector firms or considers the three-factor model, as \cite{PeyerVermaelen2009} do, the calendar method abnormal returns do become significant.\footnote{Details available upon request.}

Table~\ref{tbl:PastFindingsTimeUnderBB} re-examines whether the U-index of \cite{PeyerVermaelen2009} predicts the five factor excess returns for different time periods. The first two columns show the IRATS results and the last two columns show the Calendar Time results. Regardless of the method to compute excess returns, the U-index is an excellent predictor: except for the very short 1985-1990 period, buybacks announced by high U-index firms are followed by significantly larger returns than buybacks announced by low U-index firms.  There is also no evidence that the U-index is losing its predictive power over time: for example, in the 2001-2014 period the difference between high U-index and low index firms (after 48 months, IRATS) was \Sexpr{BBtable_undertime["+48",31]-BBtable_undertime["+48",34]}$\%$, while in the most recent 2008-2014 period high U-index firms had \Sexpr{BBtable_undertime["+48",43]-BBtable_undertime["+48",46]}$\%$ larger abnormal returns than low U-index firms.

\subsection{Robustness with respect to estimation of factor betas}
\label{sec:robustbeta}

Note that both event study methods measure alpha (excess return) and betas jointly. In other words, we do not use prior (to investing) information to estimate risk. An investor who wants to exploit the anomaly, however, may want to hedge market (and other) risk and would need to estimate betas using past data. If the buyback signals a change in risk (\cite{GrullonMichaely2004}) it is not obvious that such a hedged strategy would work. 

To further study the robustness of the buyback anomaly, we simulate a portfolio investment strategy starting in \Sexpr{firstyear}. The strategy uses past data to estimate the factor betas and measures the abnormal returns of buyback portfolios over different investment horizons. While this is not an accurate measure of the returns of a buyback fund - as we do not consider transaction costs, turnover issues, or other operational issues (see for example \cite{MitchellPulvino2001}) - it provides us with an estimate of what would have happened to an investor who starts investing in \Sexpr{firstyear} in an equally weighted portfolio of buyback stocks and holds them over various horizons.

<< fig.width=10, fig.height=6, out.width='\\textwidth', echo=F >>=
tmp = pnl_matrix(remove_initialization_time(BUYBACK_DATA_NEW$long_all12mshort_risk_factors,min_date=FirstTrade))
ri = remove_initialization_time(BUYBACK_DATA_NEW$long_all12mshort_risk_factors,min_date=FirstTrade)
expost_betas = beta_expost(ri,Risk_Factors_Monthly[,pnl_hedge_factors])
ri = remove_initialization_time(BUYBACK_DATA_NEW$pnl_returns_events_all_12M,min_date=FirstTrade)
expost_betas_unhedged = beta_expost(ri,Risk_Factors_Monthly[,pnl_hedge_factors])
@

Specifically, we consider the following trading strategy: construct the first day of every month an equally weighted portfolio of all companies that announced buybacks during the previous $N$ months, for a given holding period of length $N$ (which can be chosen). Thus, once a company makes an announcement, it enters the portfolio on the first day of the following month and remains there for $N$ months. Note that the portfolio is re-balanced (the first day of) each month. This ``unhedged'' strategy generates a time series of returns. Each month (when we re-balance the portfolio) we also use the previous \Sexpr{hedge_months}  monthly returns of this time series    to calculate the (portfolio level) time series betas of all five factors. This allows an investor to determine the betas for the factor risks using data available at the time of portfolio formation. 

<< fig.width=10, fig.height=6, out.width='\\textwidth', echo=F >>=
months1 = cumsum(100*remove_initialization_time(BUYBACK_DATA_NEW$long_all1mshort_risk_factors,min_date=FirstTrade))
months3 = cumsum(100*remove_initialization_time(BUYBACK_DATA_NEW$long_all3mshort_risk_factors,min_date=FirstTrade))
months6 = cumsum(100*remove_initialization_time(BUYBACK_DATA_NEW$long_all6mshort_risk_factors,min_date=FirstTrade))
months12 = cumsum(100*remove_initialization_time(BUYBACK_DATA_NEW$long_all12mshort_risk_factors,min_date=FirstTrade))
months24 = cumsum(100*remove_initialization_time(BUYBACK_DATA_NEW$long_all24mshort_risk_factors,min_date=FirstTrade))
months36 = cumsum(100*remove_initialization_time(BUYBACK_DATA_NEW$long_all36mshort_risk_factors,min_date=FirstTrade))
months48 = cumsum(100*remove_initialization_time(BUYBACK_DATA_NEW$long_all48mshort_risk_factors,min_date=FirstTrade))

@ 

We report the returns of such a portfolio strategy for different holding months $N$ = 1, 3, 6, 12, 24, 36, 48 in Figure~\ref{fig:ReturnsBB}.\footnote{Results for other holding periods, as in Figure~\ref{fig:ReturnsBB}, are available upon request.} The basic conclusion is that the shorter the investment horizon the larger the excess returns. Specifically, at the end of \Sexpr{lastyear} the cumulative returns from the 1 month, 6 month, 12 month, 24 month, 36 month and 48 month holding periods are respectively equal to \Sexpr{round(tail(months1,1),1)}$\%$, \Sexpr{round(tail(months3,1),1)}$\%$, \Sexpr{round(tail(months6,1),1)}$\%$, \Sexpr{round(tail(months12,1),1)}$\%$, \Sexpr{round(tail(months24,1),1)}$\%$, \Sexpr{round(tail(months36,1),1)}$\%$ and \Sexpr{round(tail(months48,1),1)}$\%$. This is not surprising as the Calendar Time results in Table~\ref{tbl:priorBuybacks} show that the monthly excess returns decline when the investment horizon becomes longer. However, Figure~\ref{fig:ReturnsBB} allows us to verify that the excess returns are not simply the result of outperformance during a particular time period. Table~\ref{tbl:allhedgedBB} shows the monthly and yearly returns of this five-factors hedged strategy for N=12.  The table shows that in \Sexpr{sum(tmp[,13] > 0)} of \Sexpr{sum(tmp[,13] != 0)} years the returns are positive, with a large \Sexpr{round(max(tmp[,13]),1)}$\%$ excess return in  \Sexpr{rownames(tmp)[which.max(tmp[,13])]}. In only one year (\Sexpr{rownames(tmp)[which.min(tmp[,13])]}) the strategy generates an abnormal loss larger than \Sexpr{round(abs(sort(tmp[,13])[2]),1)}$\%$.

Despite using pre-portfolio formation data to estimate the betas, unlike both the IRATs and Calendar Time methods that use hindsight to estimate risk, the hedged portfolio has very low betas with the five factors. For example for the $N =12$ months holding period, the betas for the five factors Market, SMB, HML, RMW, and CMA are respectively \Sexpr{round(expost_betas[2,1],3)}, \Sexpr{round(expost_betas[3,1],3)}, \Sexpr{round(expost_betas[4,1],3)}, \Sexpr{round(expost_betas[5,1],3)} and \Sexpr{round(expost_betas[6,1],3)}. The corresponding betas for the ``unhedged'' strategy are \Sexpr{round(expost_betas_unhedged[2,1],3)}, \Sexpr{round(expost_betas_unhedged[3,1],3)}, \Sexpr{round(expost_betas_unhedged[4,1],3)}, \Sexpr{round(expost_betas_unhedged[5,1],3)} and \Sexpr{round(expost_betas_unhedged[6,1],3)}. This also indicates that the returns shown in Figure~\ref{fig:ReturnsBB} and Table~\ref{tbl:allhedgedBB} are close to ``excess'' returns, i.e. returns that have basically eliminated all factors risk. This is also consistent with the hypothesis that the buyback announcement itself does not materially change the risk of the repurchasing firms (in the short term). 


\subsection{Robustness across Sectors}
\label{sec:AllIndustries}

<<   eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=
tmp = Reduce(cbind,lapply(1:length(industry_BB), function(i) industry_BB[[i]][,1:3] ))
@

Figure~\ref{fig:industryeventsBB} shows the number of buyback events per industry in our sample. The software and semiconductor industries are the most active repurchasers. They also tend to be the most volatile industries, industries where disagreement about fundamental value is large - as we report later in Table \ref{tbl:industriesR2Vol}. Table~\ref{tbl:IndustriesBB} shows the IRATS cumulative abnormal returns and Table~\ref{tbl:IndustriesBB_cal} the Calendar Time method monthly average abnormal returns when we remove one industry at the time, for the top most frequent buyback industries (those for which there are at least \Sexpr{min_industry_sampleBB} events in our sample).  Note from Table~\ref{tbl:priorBuybacks} that, after 48 months, the cumulative abnormal returns for the whole sample (using IRATS) is \Sexpr{round(IRATS_table_all_bb["+48","CAR 5F"],2)}$\%$ and the monthly average excess return (Calendar Time) is \Sexpr{round(CAL_table_all_bb["+48","CAL 5F"],2)}$\%$.  So the larger the difference between these numbers and the corresponding numbers for the industry indicated in Tables~\ref{tbl:IndustriesBB} and \ref{tbl:IndustriesBB_cal}, the larger the excess returns in the industry removed. For example, using IRATS, deleting the software industry lowers the CAR from \Sexpr{round(IRATS_table_all_bb["+48","CAR 5F"],2)}$\%$ to \Sexpr{round(tmp["+48", 3*(which(names(industry_BB) == "Software")-1)+1],2)}$\%$, a \Sexpr{round(IRATS_table_all_bb["+48","CAR 5F"] - tmp["+48", 3*(which(names(industry_BB) == "Software")-1)+1],2)}$\%$ decline. This is the largest decline in Table~\ref{tbl:IndustriesBB}, indicating that buybacks in the software industry are followed by the largest excess returns. However, deleting Retail, Insurance, Machinery, Meals and especially Chemical stocks improves the excess returns.  Of course, these differences could be explained by differences in U-index levels or other indicators of the likelihood of misvaluation, a topic we turn to next.    



\section{Excess returns and volatility}
\label{sec:infoassymetry}

There exists a large literature on volatility and stock returns. One of the most puzzling findings is the fact that total volatility and idiosyncratic volatility are negatively correlated with future abnormal returns, when expected returns are calculated using the 3 factor \cite{FamaFrench1993} model  (see e.g. \cite{Ang2006} (Table VII)). This volatility anomaly also survives after using the \cite{FamaFrench2015a} 5-factor model, at least for small firms.  Perhaps the buyback and the volatility anomaly are related: are the buyback firms with the largest excess returns also firms with the smallest (idiosyncratic) risk?  Or can we make arguments that the opposite is true, if we accept the fundamental proposition of this paper, i.e. that excess returns are a result of the fact that managers are on average successful in taking advantage of an undervalued stock price?      


\subsection{Idiosyncratic Risk}
\label{sec:idiorisk}

The main ``theory'' behind the buyback anomaly is that firms may have superior {\it company-specific} information. Such situations are more likely in industries or companies where the value is driven less by market wide factors, i.e., by highly ``idiosyncratic'' companies.  So if buybacks are driven by market timing this superior information hypothesis predicts that there should be a positive relation between idiosyncratic returns and volatility.  To test this hypothesis, for each event we measure the five-factor regression $R^2$ using the 6-months daily returns just before the event announcement.\footnote{Using shorter time windows, e.g., 1 month, or using the idiosyncratic volatility as in \cite{Ang2006}, leads to the same conclusions - results available upon request. However, as we want to differentiate between ``idiosyncratic'' companies and ``high volatility'' ones, to consider both the effects of company specific information and of the option value of a buyback announcement, we separately study the relations with $R^2$ and volatility. See also \cite{Lietal2014} for a discussion on this issue.} We define two types of events: ``low idiosyncratic'' (high $R^2$) and ``high idiosyncratic'' (low $R^2$) events, depending on whether the five-factor regression $R^2$ was in the top or bottom \Sexpr{round(100*quantile_R2,2)}$\%$ of the $R^2$ of all CRSP companies: each month we use the daily returns of all CRSP stocks for the previous 6 months until the one before last day of the previous month to calculate all companies' five-factor regression $R^2$. We also define the idiosyncratic score of a firm to be the percentile of its $1-R^2$ across all CRSP firms that month. Note that we do not need to  define 20 breakpoints as Fama-French do, and for simplicity we focus on the two extreme quantiles only. Table~\ref{tbl:industriesR2Vol}, columns (1) and (2) show the percentage of high and low idiosyncratic risk events across all industries for which we have at least 100 buyback events in our sample. The healthcare industry has the largest percentage of firms classified as ``high idiosyncratic'', while cyclical industries such as steel, construction and chemicals contain a large number of ``low idiosyncratic'' firms. 



Table~\ref{tbl:IdiosyncraticunderBB} shows the IRATS and Calendar Time abnormal returns for high and low idiosyncratic buyback events-companies. Focusing on IRATS, high idiosyncratic buyback stocks earn \Sexpr{R2_IRATStableBB["+48","High Idiosync.: CAR"]}$\%$  after 48 months, more than three times the excess returns of the low idiosyncratic announcements. The results using the Calendar Time method confirm these findings. Table~\ref{tbl:IdiosyncraticunderBB} also tests whether adjusting for idiosyncratic risk improves the predictive power of the U-index. Regardless of the time horizon and the event study method, the U-index works only for idiosyncratic companies. After 48 months, based on the IRATS methods, high U-index high idiosyncratic companies earn \Sexpr{R2_IRATStable_underBB["+48","High Idiosync.: U CAR"]}$\%$ (t=\Sexpr{R2_IRATStable_underBB["+48",8]}). Low idiosyncratic high U-index firms have only an insignificant excess return of \Sexpr{R2_IRATStable_underBB["+48",1]}$\%$ (t=\Sexpr{R2_IRATStable_underBB["+48",2]}), while for low idiosyncratic firms the low U-index IRATS excess returns are significant (\Sexpr{R2_IRATStable_underBB["+48",4]}$\%$, t=\Sexpr{R2_IRATStable_underBB["+48",5]}).  Note however that we only have few events in low idiosyncratic, high U-index (\Sexpr{R2_IRATStable_underBB["Observations",1]} events) and high idiosyncratic, low U-index (\Sexpr{R2_IRATStable_underBB["Observations",10]} events) categories. The Calendar Time results provide the same picture: only for the high idiosyncratic, high U-index firms we obtain significant (t=\Sexpr{R2_IRATStable_underBB_cal["+48",8]}) monthly excess returns of \Sexpr{R2_IRATStable_underBB_cal["+48",7]}$\%$. The high idiosyncratic and low U-index firms have  non-significant (t=\Sexpr{R2_IRATStable_underBB_cal["+48",11]}) monthly excess returns of \Sexpr{R2_IRATStable_underBB_cal["+48",10]}$\%$.\footnote{We also calculated the returns of a hedged strategy similar to Figure~\ref{fig:ReturnsBB} (Panel~B). Starting in \Sexpr{firstyear} we form a portfolio of all stocks that announced a buyback during the previous $N$ months and hold the stock for $N$ months. High idiosyncratic companies earn cumulative excess returns of  \Sexpr{round(tail(cumsum(100*High_Idiosyncr_BB_Hedged),1),1)}$\%$ (\Sexpr{round(tail(cumsum(100*High_Idiosyncr_BB_Hedged48m),1),1)}$\%$) for the 12 (48) month holding strategy. These excess returns are higher than the \Sexpr{round(tail(cumsum(100*Low_Idiosyncr_BB_Hedged),1),1)}$\%$ (\Sexpr{round(tail(cumsum(100*Low_Idiosyncr_BB_Hedged48m),1),1)}$\%$) of the corresponding low idiosyncratic sample.}


Figure \ref{fig:pastallidio} summarizes our results.  It shows the CAR based on IRATS (Panel~A for the high U-index firms, B for the low U-index firms, and C for all firms). In agreement with Table~\ref{tbl:IdiosyncraticunderBB}, the striking result (Panel~A) is that the U-index is not a good predictor of excess returns for stocks largely driven by market factors (low idiosyncratic firms). This is strong evidence that excess returns after buybacks are driven by superior company-specific information of the management.

The finding that $1-R^2$ and idiosyncratic volatility (IVOL in \cite{Ang2006}, measured as the standard deviation of the residuals of the factor model regression) are positively related to future excess returns is inconsistent with \cite{Ang2006} who find a negative relation between IVOL and expected returns. However, \cite{Stambaugh2015} argue that the relationship between IVOL and returns becomes positive for undervalued stocks. Their argument is that IVOL represents risk that deters arbitrage and therefore creates mispricing. Using a proxy for mispricing based on 11 anomalies they find indeed a positive relation between IVOL and future returns for undervalued stocks.  Their most under-priced high IVOL stocks earn monthly excess returns (relative to the Fama-French three-factor model) of 0.56$\%$ per month which is quite similar to the \Sexpr{R2_IRATStableBB_cal["+48","High Idiosync.: CAL"]}$\%$ per month reported in our Table~\ref{tbl:IdiosyncraticunderBB} Panel B (using the five-factor model).  

\subsection{Volatility}
\label{sec:volbuybacks}

The announcement of a buyback program is not a firm commitment, but an option to buy back stock. Ikenberry and Vermaelen (1996) model this flexibility as an exchange option in which the market price of the stock is exchanged for the true value of the stock. They predict that, as with all options, the value increases with the volatility. The intuition is that the larger the volatility, the larger the probability that the market price may deviate from the true value. This enhances the timing ability of the manager-insider.  They show that this option can have a lot of value, something that may not be realized at the time of the announcement of the buyback authorization.  Hence, perhaps total volatility is a better prediction of excess returns than idiosyncratic volatility or the U-index.  Or perhaps volatility can be an additional, next to the U-index and idiosyncratic volatility, indicator of the likelihood that the buyback is driven by undervaluation.  

For each event we measure their pre-announce returns volatility with the standard deviation of their daily stock returns over the 6 months prior to the buyback announcement. We define two types of events: ``low volatility'' and ``high volatility'' events, depending on whether volatility was in the top or bottom \Sexpr{round(100*quantile_VOL,2)}$\%$ of the volatilities of all CRSP companies, as we did for $R^2$ above:
each month we use the daily returns of all CRSP stocks for the previous 6 months until the one before last day of the previous month to calculate all companies' daily returns volatilities. We also define the volatility score of a firm to be the percentile of its volatility across all CRSP firms that month. Note that, again, we do not need to  define 20 breakpoints as Fama-French do, and for simplicity we focus on the two extreme quantiles only.  In total we have \Sexpr{length(High_VOL_eventsBB)} ``high volatility'' buybacks-events and \Sexpr{length(Low_VOL_eventsBB)} ``low volatility'' ones. Table~\ref{tbl:industriesR2Vol}, columns (3) and (4)  show the percentage of high and low volatility events across all industries for which we have at least 100 buyback events in our sample.


Table~\ref{tbl:VOLunderBB} shows the IRATS and Calendar Time abnormal returns for high and low volatility buybacks events-companies. Focusing on IRATS, high volatility buyback stocks earn \Sexpr{VOL_IRATStableBB["+48","High Vol: CAR"]}$\%$  after 48 months, while low volatility events have non significant abnormal returns for any period. The results using the Calendar Time method confirm these findings.\footnote{We also calculated the returns of a hedged strategy similar to Figure~\ref{fig:ReturnsBB} (Panel~B). Starting in \Sexpr{firstyear} we form a portfolio of all stocks that announced a buyback during the previous $N$ months and hold the stock for $N$ months. High volatility companies earn cumulative excess returns of  \Sexpr{round(tail(cumsum(100*High_VOL_BB_Hedged),1),1)}$\%$ (\Sexpr{round(tail(cumsum(100*High_VOL_BB_Hedged48m),1),1)}$\%$) for the 12 (48) month holding strategy, which are higher than the \Sexpr{round(tail(cumsum(100*Low_VOL_BB_Hedged),1),1)}$\%$ (\Sexpr{round(tail(cumsum(100*Low_VOL_BB_Hedged48m),1),1)}$\%$) of the corresponding low volatility sample.}

Table~\ref{tbl:VOLunderBB} also tests whether the U-index is valid for high volatility events, as well as whether adjusting for volatility improves the predictive power of the U-index. Regardless of the time horizon and the event study method, the U-index works for high volatile companies. After 48 months, based on the IRATS methods, high U-index high volatility companies earn \Sexpr{VOL_IRATStable_underBB["+48","High Vol: U CAR"]}$\%$ (t = \Sexpr{VOL_IRATStable_underBB["+48",8]}). Low U-index high volatility companies earn \Sexpr{VOL_IRATStable_underBB["+48",10]}$\%$ (t = \Sexpr{VOL_IRATStable_underBB["+48",11]}). The Calendar Time results provide the same picture. Figure~\ref{fig:pastallVOL} summarizes the results for the total sample and the high and low U-index sample. The main difference with Figure~\ref{fig:pastallidio} is that now also low volatility/high U-index firms earn significant excess returns of \Sexpr{VOL_IRATStable_underBB["+48",1]}$\%$ after 48 months.

\subsection{An Enhanced U-index for Buybacks}
\label{sec:newindex}

<<  eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=
EU_index_features = scrub(cbind(BUYBACK_DATA_NEW$DATASET$SDC$minus_Rsq_returns, BUYBACK_DATA_NEW$DATASET$SDC$pre_vol,BUYBACK_DATA_NEW$Valuation_Index))
colnames(EU_index_features) <- c("Idiosyncratic Score", "Volatility Score", "U-Index Score")
Under_IdioBB_cor = cor(EU_index_features)
@

Table~\ref{tbl:underidioallBB} shows how the high/low U-index  low/high idiosyncratic risk, and low/high volatility buyback events overlap, while Table~\ref{tbl:underidioallBBcor} shows the correlations between the idiosyncratic, volatility, and U-index scores. Overall we see that although high U-index firms tend to have high idiosyncratic risk and high volatility, while high idiosyncratic risk firms tend to also have high volatility, the overlap is not very high. For example from Table~\ref{tbl:underidioallBB} we learn that  only \Sexpr{round(Under_IdioBB["High Vol.","H Idiosync."],1)}$\%$ of the high volatility stocks that are classified as having either high or low idiosyncratic risk - note that we only consider the  \Sexpr{round(100*quantile_R2,2)}$\%$ tails - have high idiosyncratic risk. From Table~\ref{tbl:underidioallBBcor} we infer that the correlation between idiosyncratic risk and volatility is only \Sexpr{round(Under_IdioBB_cor["Volatility Score","Idiosyncratic Score"]*100,1)}$\%$.  A natural question is therefore whether one can further enhance the \cite{PeyerVermaelen2009} U-index by incorporating information about the firms pre-announce idiosyncratic risk and volatility. We consider one such combination where we simply take an equal-weighted combination of the 4 criteria into one ``Enhanced Undervaluation Index'' (EU-index). Specifically, in the spirit of the U-index of \cite{PeyerVermaelen2009}, we calculate the EU-index simply as the sum of three numbers: high U-index firms get a score of 2, low get a 0; high idiosyncratic firms get a score of 2, low get a 0; and high volatility firms get a score of 2, low get a 0. Firms that get neither 0 nor 2 (hence are in the middle of the range) get a score of 1 for each of these 3 scores.


Figure~\ref{fig:Eundervaluationindex} shows the distribution of the EU-index. The index has a symmetric distribution with a mean of \Sexpr{round(mean(EUindex_bb),2)}. Table~\ref{tbl:EUrelations} shows how the EU-index relates to a number of firm characteristics. Firm leverage, based on data the year before announcement, is defined as the ratio $debt/(debt+equity)$\footnote{We use the definitions from \url{http://www.ivo-welch.info/professional/leverage.placebo/}{Ivo Welch's website} following  \url{http://www.ivo-welch.info/professional/leverage.placebo/r-sourcecode/mksane.R}. Debt is the sum of the Compustat variables $dlc+ dltt$, where $dlc$ is ``Debt in Current Liabilities'' and $dltt$ is ``Long Term Debt - Total''. Equity is the Compustat variable $seq$ which is ``Total Parent Stockholders' Equity''. We use the most recent data pre-announce, and make the winsorization and other adjustments as in the websites above. Note that we followed the same steps as in these websites to handle negative book value of equity (in the BE/ME calculations) and any other Compustat data issues.}. ``Missed (beat) EPS'' measures the percentage of firms in the specific EU index category that missed (beat) the last EPS consensus analyst forecast before the buyback announcement. ``ISS later'' measures the percentage of firms that announced an equity issue within 48 months after the buyback announcement. Next, we measure the percentage of buybacks financed with cash (CASH) when the data is available\footnote{As this SDC data was not available for many events, we did not consider the in the U-index calculation} (this data was available only for \Sexpr{sum(!(BUYBACK_DATA_NEW$DATASET$SDC$Source...of..Funds..Code == ""))} of the events) and whether the reported purpose (available only for \Sexpr{sum(!(BUYBACK_DATA_NEW$DATASET$SDC$Purpose.Code == ""))} events) included the term ``Undervalued'', or ``Enhance Shareholder Value'' or ``stock option plan''.


<<  eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=
tmp_market_cap = round(non_zero_mean(BUYBACK_DATA_NEW$DATASET$SDC$Market.Cap[EUindex_bb %in% c(4:6)])/1000,1)
@

First there is a striking negative relation between the EU index and financial leverage. This makes sense according to the static trade-off theory of optimal capital structure: high risky firms have more financial distress and should have less debt. Second, the high EU index firms are more likely to miss earnings forecasts. To the extent that analysts base their recommendations on these earnings misses, stock prices may become undervalued. Evidence that analyst extrapolation forecast errors are a partial explanation for the buyback anomaly is documented by \cite{PeyerVermaelen2009}.  High EU index firms are more likely to mention ``undervaluation'' as a motivation for the buyback.  High EU index firms tend to have more cash. This could of course be related to the fact that risky firms should have more cash holdings.  They also tend to follow up with equity offerings after the buyback which suggests that they are more likely to be in the ``market timing'' business. The table also shows a strong negative relation between market-to-book ratios and market capitalization and the EU index, which is not surprising as these are components of the index. It should be noted that the EU 6 portfolio is composed of very small stocks with an average market capitalization of \$\Sexpr{round(EU_relations["Market Cap.","EU6"],1)} million. The average market capitalization of portfolios with long term (after 48 months) monthly excess return of larger than 0.3$\%$ (i.e. portfolios EU4 through EU6 in Table~\ref{tbl:EUunderBBcal}) is \$\Sexpr{tmp_market_cap} billion (not indicated in the Table). So the buyback anomaly is to some extent a small cap anomaly, although portfolio EU3 for which the average market capitalization of its \Sexpr{sum(EUindex_bb==3)} firms is \$\Sexpr{round(non_zero_mean(BUYBACK_DATA_NEW$DATASET$SDC$Market.Cap[EUindex_bb ==3])/1000,1)} billion still has significant abnormal returns. 

Tables  \ref{tbl:EUunderBB} and \ref{tbl:EUunderBBcal} show respectively the IRATS and Calendar Time monthly abnormal returns for all values of the EU-index. Focusing on IRATS, as the EU-index increases, the long term abnormal returns increase (from \Sexpr{round(EU_IRATStable_bb["+48",1],1)}$\%$ to \Sexpr{round(EU_IRATStable_bb["+48",19],1)}$\%$). Figure~\ref{fig:Epastall} show the same results over time for each EU-index. Long-term cumulative excess returns after 48 months are becoming statistically significantly positive at EU-index levels of 3 and higher, and then steadily increase from \Sexpr{round(EU_IRATStable_bb["+48",10],1)}$\%$ to \Sexpr{round(EU_IRATStable_bb["+48",19],1)}$\%$. The Calendar Time results are similar although they only show significance starting at EU-index levels of 4.  Investing in the very high EU index firms (EU=6) generates alphas of \Sexpr{round(EU_CALtable_bb["+48",19],2)}$\%$ per month for 48 months.\footnote{We also calculated the returns of a hedged strategy similar to Figure~\ref{fig:ReturnsBB} (Panel~B). Starting in \Sexpr{firstyear} we form a portfolio of all stocks that announced a buyback during the previous $N$ months and hold the stock for $N$ months. The 12-month holding period high EU-index portfolio has average annual abnormal returns of \Sexpr{round(pnl_stats(High_EU_BB_Hedged)[1],1)}$\%$, while the low EU-index one earns only \Sexpr{round(pnl_stats(Low_EU_BB_Hedged)[1],1)}$\%$ annual excess returns. For the 48-month holding periods the high and low EU-index portfolio earn annual excess returns of  respectively, \Sexpr{round(pnl_stats(High_EU_BB_Hedged48m)[1],1)}$\%$ and \Sexpr{round(pnl_stats(Low_EU_BB_Hedged48m)[1],1)}$\%$.} 

The bottom line is that combining volatility, idiosyncratic risk and the U-index in one EU- index generates a more selective predictor of excess returns than each of the indicators separately. Indeed, high U-index stocks, stocks with high idiosyncratic risk, and high volatile stocks generate cumulative excess returns of respectively \Sexpr{IRATS_table_all_bb_undervaluation["+48","U:CAR5F"]}$\%$ (Table~\ref{tbl:priorBuybacks}), \Sexpr{R2_IRATStableBB["+48","High Idiosync.: CAR"]}$\%$ (Table~\ref{tbl:IdiosyncraticunderBB}) and \Sexpr{VOL_IRATStableBB["+48","High Vol: CAR"]}$\%$ (Table~\ref{tbl:VOLunderBB}).      

\subsection{Robustness of the EU-index over Time}
\label{sec:finalrobustness}

As volatility and idiosyncratic risk are time dependent, the performance of the new EU-index may not be robust over time - e.g., relative to the U-index of \cite{PeyerVermaelen2009}.  Tables \ref{tbl:EUTimeUnderBB} (IRATS) and \ref{tbl:EUTimeUnderBBcal} (Calendar Time method), like Table~\ref{tbl:PastFindingsTimeUnderBB} for the U-index, show the relative performance of high and low EU-index repurchases. In order to have roughly similar number of under/overvalued firms as when we use the U-index, we define low EU-index firms to those for which the EU-index is 0-1, and high for which it is 5-6 (the index takes values from 0 to 6). With this definition we have \Sexpr{sum(low_EU_bb)} low EU-index and \Sexpr{sum(high_EU_bb)}  high EU-index firms in our sample (in comparison with \Sexpr{sum(company_subset_overvalued_bb)} low U-index and \Sexpr{sum(company_subset_undervalued_bb)} high U-index ones).

Tables \ref{tbl:EUTimeUnderBB} and \ref{tbl:EUTimeUnderBBcal} indicate that the EU-index is robust over time, with the exception of the 1985-1990 period. However during this period our high EU index sample only contains \Sexpr{ECAL_table_undervaluation_time_bb["Observations",1]} observations which results in statistically insignificant excess returns beyond the 12 month horizon. 

<< fig.width=10, fig.height=6, out.width='\\textwidth', echo=F >>=
tmp = pnl_matrix(remove_initialization_time(High_EU_BB_Hedged,min_date=FirstTrade))
tmp1 = pnl_matrix(remove_initialization_time(BUYBACK_DATA_NEW$long_all12mshort_risk_factors,min_date=FirstTrade))

@

%Finally, Table~\ref{tbl:EUhedgedBB}, like Table~\ref{tbl:allhedgedBB}, shows the monthly and yearly returns of a five-factors hedged strategy investing only in the high EU-index repurchase events.  The table shows the robustness of the abnormal returns over time. Specifically, in \Sexpr{sum(tmp[,13] > 0)} out of the \Sexpr{sum(tmp[,13] != 0)} years the hedged strategy generates positive excess returns. As in Table~\ref{tbl:allhedgedBB},  \Sexpr{rownames(tmp)[which.min(tmp1[,13])]} has a large a loss of \Sexpr{tmp[which.min(tmp1[,13]),13]}$\%$ and the best year is \Sexpr{rownames(tmp)[which.max(tmp[,13])]} with an impressive \Sexpr{tmp[which.max(tmp[,13]),13]}$\%$. 


%########################################################################################################
%## REPORT.RNW SPECIAL CODE:
%########################################################################################################

\section{Additional Variables Exploration}
<< Generate extra sections, echo=F,eval=T,results='asis' >>=
#this cats the text but returns some tables to be place at the end
options(warn=-1) #because some period don't have data

sec1 <- generate_section(input$characteristic_irats1,input$characteristic_irats1_sign,input$quantile_used_ind)
sec2 <- generate_section(input$characteristic_irats2,input$characteristic_irats2_sign,input$quantile_used_ind)
sec3 <- generate_section(input$characteristic_irats3,input$characteristic_irats3_sign,input$quantile_used_ind)
sec4 <- generate_section(input$characteristic_irats4,input$characteristic_irats4_sign,input$quantile_used_ind)
sec5 <- generate_section(input$characteristic_irats5,input$characteristic_irats5_sign,input$quantile_used_ind)
sec6 <- generate_section(input$characteristic_irats6,input$characteristic_irats6_sign,input$quantile_used_ind)

secU <- generate_U_section(sec1,sec2,sec3,sec4,sec5,sec6, input$quantile_used_ind,input$quantile_used_all)
options(warn=0) #because some period don't have data

@
%########################################################################################################
%########################################################################################################


\section{Conclusion}
\label{sec:conclusion}

The buyback anomaly first reported by Ikenberry, Lakonishok and Vermaelen (1995) is still alive and robust. Long term excess returns are large, highly statistically significant and robust even when we replace the Fama-French three-factor model with the Fama-French five-factor model. We believe that the difference with the conclusions of \cite{FamaFrench2015b} is a result of the fact that we do not pool buybacks and equity issues in a ``net issuance'' anomaly. A buyback is not simply the inverse of an equity issue, especially in a world with asymmetric information. Managers who buy back undervalued stock from selling investors benefit their long-term shareholders at the expense of selling shareholders who are ``leaving'' the company. Issuing overvalued stock to new investors is not exactly enhancing good investor relations.  Hence it is not surprising to find that the equity issue anomaly does not survive after appropriately adjusting for risk. Moreover buyback authorizations are options, not firm commitments such as equity issues. Using net issues as a measure of (negative) buyback activity ignores the reality that an actual repurchase may occur several months, if not years after a buyback authorization. By the time the buyback is completed the firm may already have experienced significant excess returns. 

Not all buybacks are the same: we find that buybacks made by small beaten up risky low market to book companies earn the largest excess returns.  We find that both idiosyncratic risk (small $R^2$) and total risk are positively correlated with future returns. The results that idiosyncratic risk is positively correlated with returns is inconsistent with \cite{Ang2006} but consistent with \cite{Stambaugh2015} who show that for undervalued firms IVOL is positively related to expected returns. We combine these characteristics in a new measure: the EU index or Enhanced Undervaluation Index, building on the analysis of \cite{PeyerVermaelen2009}. Investing in very high EU index firms generates Fama-French five-factor adjusted returns of \Sexpr{round(EU_CALtable_bb["+48",19],2)}$\%$ per month during the 48 months after the buyback announcement.  These are also firms that mention in their press releases that they are buying back stock because they are undervalued.  They are more likely to miss earnings forecasts relative to the other buyback firms and therefore falling out of favor with analysts.  However investing in high EU index firms to some extent implies investing in small caps and micro-caps, which may explain partially why the anomaly persists as these firms may not satisfy, for example, liquidity risk constraints of many funds.


\newpage

\bibliographystyle{jfe}
\bibliography{Bibliography}

\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% FIRST ALL TABLES
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% BASIC ANALYSIS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\clearpage

<<   eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=
printLatexTable2(
  cbind(IRATS_table_all_bb,IRATS_table_all_bb_undervaluation)[reported_times,],
  cbind(CAL_table_all_bb,CAL_table_all_bb_undervaluation)[reported_times,],
  columns = c("All 3F","All 5F","High U-index 3F","Low U-index 3F","High U-index 5F","Low U-index 5F"),
  title="Buyback announcements during 1985-2014",
  title1 = "Panel A: IRATs Cumulative Abnormal Returns",
  title2 = "Panel B: Calendar Time Method Monthly Abnormal Returns",
  caption="The table presents the abnormal returns for firms after open market repurchase announcements from the announcement date until $t$ months after announcement. We include a version of the abnormal returns for the full sample and one for both companies with a high U-index and a low U-index. Panel~A reports monthly cumulative average abnormal returns (CAR) in percent using Ibbotson's (1975) returns across time and security (IRATS) method combined with the Fama French (1993) three-factor model and the \\cite{FamaFrench2015a} five-factor model for the sample of firms that announced an open market share repurchase plus various subsamples. The following regressions are run each event month~$j$:\\vspace{-1em}
\\begin{eqnarray*}
(R_{i,t} - R_{f,t}) &=& a_j + b_j (R_{m,t} - R_{f,t}) + c_j {SMB}_t + d_j {HML}_t + \\epsilon_{i,t}, \\\\
(R_{i,t} - R_{f,t}) &=& a_j + b_j (R_{m,t} - R_{f,t}) + c_j {SMB}_t + d_j {HML}_t + e_t {RMW}_t + f_t {CMA}_t + \\epsilon_{i,t},
\\end{eqnarray*}
where $R_{i,t}$ is the monthly return on security $i$ in the calendar month $t$ that corresponds to the event month $j$, with $j = 0$ being the month of the repurchase announcement. $R_{f,t}$ and $R_{m,t}$ are the risk-free rate and the return on the equally weighted CRSP index, respectively. ${SMB}_t$, ${HML_t}$, ${RMW}_t$, ${CMA}_t$ are the monthly returns on the size, book-to-market factor, profitability factor and investment factor in month $t$, respectively. The numbers reported are sums of the intercepts of cross-sectional regressions over the relevant event-time-periods expressed in percentage terms. The standard error (denominator of the $t$-statistic) for a window is the square root of the sum of the squares of the monthly standard errors. Panel~B reports monthly average abnormal returns (AR) of equally weighted Calendar Time portfolios using the \\cite{FamaFrench2015a} five-factor model. In this method, event firms that have announced an open market buyback in the last calendar months form the basis of the calendar month portfolio. A single time-series regression is run with the excess returns of the calendar portfolio as the dependent variable and the returns of five factors as the independent variables. The significance levels are indicated by * and ** and correspond to a significance level of $5\\%$ and $1\\%$ respectively, using a two-tailed test.
",
label = "tbl:priorBuybacks",
bigtitleontop=T,
titleontop=T,
metric1 = "CAR",
metric2 = "AR",
scale=1,
lastSpecial=T,
dorotate=T
)

@
\clearpage

\clearpage

<<   eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=
printLatexTable2(
  IRATS_table_all_iss[reported_times,],
  CAL_table_all_iss[reported_times,],
  columns = c("All 3F","All 5F"),
  title="Issue announcements during 1985-2014",
  title1 = "Panel A: IRATs Cumulative Abnormal Returns",
  title2 = "Panel B: Calendar Method Monthly Abnormal Returns",
  caption= "The table presents the abnormal returns for firms after issue announcements from the announcement date until $t$ months after the announcement. Panel~A reports monthly cumulative average abnormal returns (CAR) in percent using Ibbotson's (1975) returns across time and security (IRATS) method combined with the Fama French (1993) three-factor model and the Fama French (2015) five-factor model for the sample of firms that announced equity issuance plus various subsamples. The following regressions are run each event month~$j$:
\\begin{eqnarray*}
(R_{i,t} - R_{f,t}) &=& a_j + b_j (R_{m,t} - R_{f,t}) + c_j {SMB}_t + d_j {HML}_t + \\epsilon_{i,t}, \\\\
(R_{i,t} - R_{f,t}) &=& a_j + b_j (R_{m,t} - R_{f,t}) + c_j {SMB}_t + d_j {HML}_t + e_t {RMW}_t + f_t {CMA}_t + \\epsilon_{i,t},
\\end{eqnarray*}
where $R_{i,t}$ is the monthly return on security $i$ in the calendar month $t$ that corresponds to the event month $j$, with $j = 0$ being the month of the repurchase announcement. $R_{f,t}$ and $R_{m,t}$ are the risk-free rate and the return on the equally weighted CRSP index, respectively. ${SMB}_t$, ${HML_t}$, ${RMW}_t$, ${CMA}_t$ are the monthly returns on the size, book-to-market factor, profitability factor and investment factor in month $t$, respectively. The numbers reported are sums of the intercepts of cross-sectional regressions over the relevant event-time-periods expressed in percentage terms. The standard error (denominator of the $t$-statistic) for a window is the square root of the sum of the squares of the monthly standard errors. Panel~B reports monthly average abnormal returns (AR) of equally weighted Calendar Time portfolios using the \\cite{FamaFrench2015a} five-factor model. In this method, event firms that have announced an open market buyback in the last calendar months form the basis of the calendar month portfolio. A single time-series regression is run with the excess returns of the calendar portfolio as the dependent variable and the returns of five factors as the independent variables. The significance levels are indicated by * and ** and correspond to a significance level of $5\\%$ and $1\\%$ respectively, using a two-tailed test.
",

label = "tbl:priorIssuers",
bigtitleontop=T,
titleontop=T,
metric1 = "CAR",
metric2 = "AR",
scale=1,
lastSpecial=T,
dorotate=F
)
@

%\clearpage

<<  eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=
printLatexTable2(
  Exit_on_SEO_Abn_table[reported_times,],
  Exit_on_SEO_Abn_table_cal[reported_times,],
  columns = c("No Issue","Issue"),
  title="Buybacks with and without subsequent issue",
  title1 = "Panel A: IRATs Cumulative Abnormal Returns",
  title2 = "Panel B: Calendar Method Monthly Abnormal Returns",
  caption="The table presents the long-run abnormal returns for firms repurchase announcements for events with and without a subsequent SEO announcement. Panel~A reports monthly cumulative average abnormal returns (CAR) in percent using Ibbotson's (1975) returns across time and security (IRATS) method combined with the \\cite{FamaFrench2015a} five-factor model for the sample of firms that announced an open market share repurchase plus various subsamples. The following regression is run each event month~$j$:
\\begin{eqnarray*}
(R_{i,t} - R_{f,t}) &=& a_j + b_j (R_{m,t} - R_{f,t}) + c_j {SMB}_t + d_j {HML}_t + e_t {RMW}_t + f_t {CMA}_t + \\epsilon_{i,t},
\\end{eqnarray*}
where $R_{i,t}$ is the monthly return on security $i$ in the calendar month $t$ that corresponds to the event month $j$, with $j = 0$ being the month of the repurchase announcement. $R_{f,t}$ and $R_{m,t}$ are the risk-free rate and the return on the equally weighted CRSP index, respectively. ${SMB}_t$, ${HML_t}$, ${RMW}_t$, ${CMA}_t$ are the monthly returns on the size, book-to-market factor, profitability factor and investment factor in month $t$, respectively. The numbers reported are sums of the intercepts of cross-sectional regressions over the relevant event-time-periods expressed in percentage terms. The standard error (denominator of the $t$-statistic) for a window is the square root of the sum of the squares of the monthly standard errors. Panel~B reports monthly average abnormal returns (AR) of equally weighted Calendar Time portfolios using the \\cite{FamaFrench2015a} five-factor model. In this method, event firms that have announced an open market buyback in the last calendar months form the basis of the calendar month portfolio. A single time-series regression is run with the excess returns of the calendar portfolio as the dependent variable and the returns of five factors as the independent variables. The significance levels are indicated by * and ** and correspond to a significance level of $5\\%$ and $1\\%$ respectively, using a two-tailed test.",



label = "tbl:BBISSexit",
bigtitleontop=T,
titleontop=T,
metric1 = "CAR",
metric2 = "AR",
scale=1,
lastSpecial=T,
dorotate=F
)

if(! is.null(ISS_for_BB_Abn_table)) {
  colnames(ISS_for_BB_Abn_table)[1]<- "Post-buyback SEOs"
  colnames(ISS_for_BB_Abn_table)[4]<- "Other SEOs"
  
  printLatexTable(ISS_for_BB_Abn_table[c("-6","+1", "+3", "+6","+24","+48","Observations"),],
                  label  = "tbl:BBISSexitAfter",
                  columns= c("After a Buyback","No Prior Buyback"),
                  title  ="Issue announcements with and without a prior buyback",
                  caption = "The table presents the long-run abnormal returns (CAR) for firms after issue announcements for events with and without a prior buyback announcement within 48 months. We report the monthly cumulative average abnormal returns (CAR) in percent using Ibbotson's (1975) returns across time and security (IRATS) method combined with the \\cite{FamaFrench2015a} five-factor model for the sample of firms that announced an open market share repurchase plus various subsamples. The following regression is run each event month~$j$:
  \\begin{eqnarray*}
  (R_{i,t} - R_{f,t}) &=& a_j + b_j (R_{m,t} - R_{f,t}) + c_j {SMB}_t + d_j {HML}_t + e_t {RMW}_t + f_t {CMA}_t + \\epsilon_{i,t},
  \\end{eqnarray*}
  where $R_{i,t}$ is the monthly return on security $i$ in the calendar month $t$ that corresponds to the event month $j$, with $j = 0$ being the month of the repurchase announcement. $R_{f,t}$ and $R_{m,t}$ are the risk-free rate and the return on the equally weighted CRSP index, respectively. ${SMB}_t$, ${HML_t}$, ${RMW}_t$, ${CMA}_t$ are the monthly returns on the size, book-to-market factor, profitability factor and investment factor in month $t$, respectively. The numbers reported are sums of the intercepts of cross-sectional regressions over the relevant event-time-periods expressed in percentage terms. The standard error (denominator of the $t$-statistic) for a window is the square root of the sum of the squares of the monthly standard errors.",
  
  lastSpecial=T,
  titleontop = T
  )
} else {
  cat("\\begin{table}
  \\caption{Issue announcements with and without a prior buyback: not enough data to generate}
  \\label{tbl:BBISSexitAfter}
  \\end{table}
  ");
}
@

%%%%%%%%

%\clearpage
<<  eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=
if (0){
  printLatexTable2(
    Exit_on_BB_Abn_table[reported_times,],
    Exit_on_BB_Abn_table_cal[reported_times,],
    columns = c("No Buyback","Buyback"),
    title="SEOs with and without subsequent buyback",
    title1 = "Panel A: IRATs Cumulative Abnormal Returns",
    title2 = "Panel B: Calendar Method Monthly Abnormal Returns",
    caption="The table presents the long-run abnormal returns for firms after issue announcements with and without a subsequent buyback announcement on the full sample for different periods in time. Panel~A reports monthly cumulative average abnormal returns (CAR) in percent using Ibbotson's (1975) returns across time and security (IRATS) method combined with the \\cite{FamaFrench2015a} five-factor model for the sample of firms that announced an open market share repurchase plus various subsamples. The following regression is run each event month~$j$:
\\begin{eqnarray*}
(R_{i,t} - R_{f,t}) &=& a_j + b_j (R_{m,t} - R_{f,t}) + c_j {SMB}_t + d_j {HML}_t + e_t {RMW}_t + f_t {CMA}_t + \\epsilon_{i,t},
\\end{eqnarray*}
where $R_{i,t}$ is the monthly return on security $i$ in the calendar month $t$ that corresponds to the event month $j$, with $j = 0$ being the month of the repurchase announcement. $R_{f,t}$ and $R_{m,t}$ are the risk-free rate and the return on the equally weighted CRSP index, respectively. ${SMB}_t$, ${HML_t}$, ${RMW}_t$, ${CMA}_t$ are the monthly returns on the size, book-to-market factor, profitability factor and investment factor in month $t$, respectively. The numbers reported are sums of the intercepts of cross-sectional regressions over the relevant event-time-periods expressed in percentage terms. The standard error (denominator of the $t$-statistic) for a window is the square root of the sum of the squares of the monthly standard errors. Panel~B reports monthly average abnormal returns (AR) of equally weighted Calendar Time portfolios using the \\cite{FamaFrench2015a} five-factor model. In this method, event firms that have announced an open market buyback in the last calendar months form the basis of the calendar month portfolio. A single time-series regression is run with the excess returns of the calendar portfolio as the dependent variable and the returns of five factors as the independent variables. The significance levels are indicated by * and ** and correspond to a significance level of $5\\%$ and $1\\%$ respectively, using a two-tailed test.",

label = "tbl:ISSBBexit",
bigtitleontop=T,
titleontop=T,
scale=1,
lastSpecial=T,
dorotate=F
  )
  
  printLatexTable(BB_for_ISS_Abn_table[c("-6","+1", "+3", "+6","+24","+48","Observations"),],
                  label  = "tbl:ISSBBexitAfter",
                  columns= c("post-Issue Buybacks: CAR","Other Buybacks: CAR"),
                  title  ="Long-run IRATS abnormal return of only the buybacks that are announced within 48 months after an SEO announcement versus the remaining buyback events.",lastSpecial=T)
}
@

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TIME ROBUSTNESS ANALYSIS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\subsection{Robustness over time}
%\label{app:robusttime}

<<   eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=
tmp = BBtable_time[reported_times,c(4,5,6,10,11,12,16,17,18,22,23,24)]
colnames(tmp) <- c("1985-1990: CAR","t-stat","p-value","1991-2000: CAR","t-stat","p-value","2001-2014: CAR","t-stat","p-value","2008-2014: CAR","t-stat","p-value")
tmp2 = BBtable_time_cal[reported_times,c(4,5,6,10,11,12,16,17,18,22,23,24)]
colnames(tmp2) <- c("1985-1990: CAL","t-stat","p-value","1991-2000: CAL","t-stat","p-value","2001-2014: CAL","t-stat","p-value","2008-2014: CAL","t-stat","p-value")

printLatexTable2(
  tmp,
  tmp2,
  columns= c("1985-1990","1991-2000","2001-2014","2008-2014"),
  title="Buyback returns over different time periods",
  title1 = "Panel A: IRATs Cumulative Abnormal Returns",
  title2 = "Panel B: Calendar Method Monthly Abnormal Returns",
  caption="The table presents the long-run abnormal returns for firms after repurchase announcements for different time periods.  Panel~A reports monthly cumulative average abnormal returns (CAR) in percent using Ibbotson's (1975) returns across time and security (IRATS) method combined with the \\cite{FamaFrench2015a} five-factor model for the sample of firms that announced an open market share repurchase plus various subsamples. The following regression is run each event month~$j$:
\\begin{eqnarray*}
(R_{i,t} - R_{f,t}) &=& a_j + b_j (R_{m,t} - R_{f,t}) + c_j {SMB}_t + d_j {HML}_t + e_t {RMW}_t + f_t {CMA}_t + \\epsilon_{i,t},
\\end{eqnarray*}
where $R_{i,t}$ is the monthly return on security $i$ in the calendar month $t$ that corresponds to the event month $j$, with $j = 0$ being the month of the repurchase announcement. $R_{f,t}$ and $R_{m,t}$ are the risk-free rate and the return on the equally weighted CRSP index, respectively. ${SMB}_t$, ${HML_t}$, ${RMW}_t$, ${CMA}_t$ are the monthly returns on the size, book-to-market factor, profitability factor and investment factor in month $t$, respectively. The numbers reported are sums of the intercepts of cross-sectional regressions over the relevant event-time-periods expressed in percentage terms. The standard error (denominator of the $t$-statistic) for a window is the square root of the sum of the squares of the monthly standard errors. Panel~B reports monthly average abnormal returns (AR) of equally weighted Calendar Time portfolios using the \\cite{FamaFrench2015a} five-factor model. In this method, event firms that have announced an open market buyback in the last calendar months form the basis of the calendar month portfolio. A single time-series regression is run with the excess returns of the calendar portfolio as the dependent variable and the returns of five factors as the independent variables. The significance levels are indicated by * and ** and correspond to a significance level of $5\\%$ and $1\\%$ respectively, using a two-tailed test.",

label = "tbl:PastFindingsTimeBB",
bigtitleontop=T,
titleontop=T,
metric1 = "CAR", metric2 = "AR",
scale=1,
lastSpecial=T,
dorotate=T
)

if (0){
  tmp = ISStable_time[reported_times,c(4,5,6,10,11,12,16,17,18,22,23,24)]
  colnames(tmp) <- c("1985-1990: CAR","t-stat","p-value","1991-2000: CAR","t-stat","p-value","2001-2014: CAR","t-stat","p-value","2008-2014: CAR","t-stat","p-value")
  tmp2 = ISStable_time_cal[reported_times,c(4,5,6,10,11,12,16,17,18,22,23,24)]
  colnames(tmp2) <- c("1985-1990: CAL","t-stat","p-value","1991-2000: CAL","t-stat","p-value","2001-2014: CAL","t-stat","p-value","2008-2014: CAL","t-stat","p-value")
  
  printLatexTable2(
    tmp,
    tmp2,
    columns= c("1985-1990","1991-2000","2001-2014","2008-2014"),
    title="SEOs returns over different time periods",
    title1 = "Panel A: IRATs Cumulative Abnormal Returns",
    title2 = "Panel B: Calendar Method Monthly Abnormal Returns",
    caption="Long-run IRATS cumulative (Panel~A) and Calendar method monthly (Panel~B) abnormal return after issue announcements for different time periods.",
    label = "tbl:PastFindingsTimeISS",
    bigtitleontop=T,
    titleontop=T,
    scale=1,
    lastSpecial=T,
    dorotate=T
  )
}

@

\clearpage

<<   eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=
one_table = cbind(BBtable_undertime[reported_times,7:12],BB_cal_table_undertime[reported_times,7:12],
                  BBtable_undertime[reported_times,19:24],BB_cal_table_undertime[reported_times,19:24],
                  BBtable_undertime[reported_times,31:36],BB_cal_table_undertime[reported_times,31:36],
                  BBtable_undertime[reported_times,43:48],BB_cal_table_undertime[reported_times,43:48]
)
#one_table = BBtable_undertime
printLatexTable(one_table[,1:12],
                columns = c("High U-index (IRATS)","Low U-index (IRATS)","High U-index (CAL)","Low U-index (CAL)"),
                rowcolumn="1985-1990",
                title="Buyback returns for the U-index over time",
                caption="The table presents the long-run abnormal returns for firms after open market repurchase announcements for high and low U-index firms in different time periods and shows significantly larger returns by buybacks announced by high U-index firms compared to those with a low U-index. We report both the IRATS cumulative average abnormal returns (CAR, Panel~A) and the calender time method (AR, Panel~B) abnormal returns on the full sample. $t$-Statistics are provided and stars indicate significance at the $5\\%$ (*), and $1\\%$ level (**). \\\\",
                label="tbl:PastFindingsTimeUnderBB",metric=c("CAR", "CAR", "AR", "AR"),
                scale = 1,close=F,lastSpecial=T
)
printLatexTable(one_table[reported_times,13:24],open=F,close=F,rowcolumn="1991-2000",columns = c("High U-index (IRATS)","Low U-index (IRATS)","High U-index (CAL)","Low U-index (CAL)"),metric=c("CAR", "CAR", "AR", "AR"),scale = 1,lastSpecial=T)
printLatexTable(one_table[reported_times,25:36],open=F,close=F,rowcolumn="2001-2014",columns = c("High U-index (IRATS)","Low U-index (IRATS)","High U-index (CAL)","Low U-index (CAL)"),metric=c("CAR", "CAR", "AR", "AR"),scale = 1,lastSpecial=T)
printLatexTable(one_table[reported_times,37:48],open=F,rowcolumn="2008-2014",columns = c("High U-index (IRATS)","Low U-index (IRATS)","High U-index (CAL)","Low U-index (CAL)"),metric=c("CAR", "CAR", "AR", "AR"),scale = 1,lastSpecial=T) 


if (0){
  paste(printLatexTable(BB_cal_table_undertime[reported_times,1:12],
                        columns = c("Under 3FF","Over 3FF","Under 5FF","Over 5FF"),
                        rowcolumn="1985-1990",
                        title="Calendar Method abnormal returns after open market repurchase announcements  for under and over valued companies over different time periods.",
                        label="tbl:PastFindingsTimeUnderBBcal",
                        scale = 0.8,close=F,lastSpecial=T
  ),
  printLatexTable(BB_cal_table_undertime[reported_times,13:24],open=F,close=F,rowcolumn="1991-2000",columns = c("Under 3FF","Over 3FF","Under 5FF","Over 5FF"),scale = 0.9,lastSpecial=T),
  printLatexTable(BB_cal_table_undertime[reported_times,25:36],open=F,close=F,rowcolumn="2001-2014",columns = c("Under 3FF","Over 3FF","Under 5FF","Over 5FF"),scale = 0.9,lastSpecial=T),
  printLatexTable(BB_cal_table_undertime[reported_times,37:48],open=F,rowcolumn="2008-2014",columns = c("Under 3FF","Over 3FF","Under 5FF","Over 5FF"),scale = 0.9,lastSpecial=T), sep="\n")
  
}
if (0){
  paste(printLatexTable(ISStable_undertime[reported_times,1:12],
                        columns = c("Under 3FF","Over 3FF","Under 5FF","Over 5FF"),
                        rowcolumn="1985-1990",
                        title="Long-run IRATS abnormal returns after issue announcements  for under and over valued companies over different time periods.",
                        label="tbl:PastFindingsTimeUnderISS",
                        scale = 0.9,close=F,lastSpecial=T
  ),
  printLatexTable(ISStable_undertime[reported_times,13:24],open=F,close=F,rowcolumn="1991-2000",columns = c("Under 3FF","Over 3FF","Under 5FF","Over 5FF"),scale = 0.9,lastSpecial=T),
  printLatexTable(ISStable_undertime[reported_times,25:36],open=F,close=F,rowcolumn="2001-2014",columns = c("Under 3FF","Over 3FF","Under 5FF","Over 5FF"),scale = 0.9,lastSpecial=T),
  printLatexTable(ISStable_undertime[reported_times,37:48],open=F,rowcolumn="2008-2014",columns = c("Under 3FF","Over 3FF","Under 5FF","Over 5FF"),scale = 0.9,lastSpecial=T), sep="\n")
  
  paste(printLatexTable(ISS_cal_table_undertime[reported_times,1:12],
                        columns = c("Under 3FF","Over 3FF","Under 5FF","Over 5FF"),
                        rowcolumn="1985-1990",
                        title="Calendar Method abnormal returns after issue announcements  for under and over valued companies over different time periods.",
                        label="tbl:PastFindingsTimeUnderISScal",
                        scale = 0.9,close=F,lastSpecial=T
  ),
  printLatexTable(ISS_cal_table_undertime[reported_times,13:24],open=F,close=F,rowcolumn="1991-2000",columns = c("Under 3FF","Over 3FF","Under 5FF","Over 5FF"),scale = 0.9,lastSpecial=T),
  printLatexTable(ISS_cal_table_undertime[reported_times,25:36],open=F,close=F,rowcolumn="2001-2014",columns = c("Under 3FF","Over 3FF","Under 5FF","Over 5FF"),scale = 0.9,lastSpecial=T),
  printLatexTable(ISS_cal_table_undertime[reported_times,37:48],open=F,rowcolumn="2008-2014",columns = c("Under 3FF","Over 3FF","Under 5FF","Over 5FF"),scale = 0.9,lastSpecial=T), sep="\n")
}
@


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% INDUSTRIES ANALYSIS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\clearpage


<<   eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=
tmp = Reduce(cbind,lapply(1:length(industry_BB), function(i) industry_BB[[i]][,1:3] ))
tmp_cal = Reduce(cbind,lapply(1:length(industry_BB), function(i) industry_BB[[i]][,4:6] ))

printLatexTable2(
  tmp[reported_times,1:(3*6)],
  tmp[reported_times,(3*6+1):36],
  columns= names(industry_BB)[1:6],
  columns2= names(industry_BB)[7:12],
  title="Buyback IRATS Abnormal Returns: Industry Robustness",
  #title1 = "",
  #title2 = "",
  caption=paste("The table presents the long-run abnormal returns for firms after repurchase announcements after removing each of the industries indicated from the sample. We report the monthly cumulative average abnormal returns (CAR) in percent using Ibbotson's (1975) returns across time and security (IRATS) method combined with the \\cite{FamaFrench2015a} five-factor model for the sample of firms that announced an open market share repurchase plus various subsamples. The following regression is run each event month~$j$:
\\begin{eqnarray*}
(R_{i,t} - R_{f,t}) &=& a_j + b_j (R_{m,t} - R_{f,t}) + c_j {SMB}_t + d_j {HML}_t + e_t {RMW}_t + f_t {CMA}_t + \\epsilon_{i,t},
\\end{eqnarray*}
where $R_{i,t}$ is the monthly return on security $i$ in the calendar month $t$ that corresponds to the event month $j$, with $j = 0$ being the month of the repurchase announcement. $R_{f,t}$ and $R_{m,t}$ are the risk-free rate and the return on the equally weighted CRSP index, respectively. ${SMB}_t$, ${HML_t}$, ${RMW}_t$, ${CMA}_t$ are the monthly returns on the size, book-to-market factor, profitability factor and investment factor in month $t$, respectively. The numbers reported are sums of the intercepts of cross-sectional regressions over the relevant event-time-periods expressed in percentage terms. The standard error (denominator of the $t$-statistic) for a window is the square root of the sum of the squares of the monthly standard errors. The 48 month abnormal return for the full sample is equal to ",round(IRATS_table_all_bb["+48","CAR 5F"],2),"$\\%$, other values are reported in Table~\\ref{tbl:priorBuybacks}.",sep=""),

label = "tbl:IndustriesBB",
bigtitleontop=T,
metric1 = "CAR", metric2 = "CAR",
#titleontop=T,
scale=1,
lastSpecial=T,
dorotate=T
)

printLatexTable2(
  tmp_cal[reported_times,1:(3*6)],
  tmp_cal[reported_times,(3*6+1):36],
  columns= names(industry_BB)[1:6],
  columns2= names(industry_BB)[7:12],
  title="Buyback Calendar Method Abnormal Returns: Industry Robustness",
  #title1 = "",
  #title2 = "",
  caption=paste("The table presents the long-run calendar method abnormal returns for firms after repurchase announcements after removing each of the industries indicated from the sample.  Specifically, we report the monthly average abnormal returns (AR) of equally weighted Calendar Time portfolios using the \\cite{FamaFrench2015a} five-factor model. In this method, event firms that have announced an open market buyback in the last calendar months form the basis of the calendar month portfolio. A single time-series regression is run with the excess returns of the calendar portfolio as the dependent variable and the returns of five factors (the difference between the risk-free rate and the return on the equally weighted CRSP index, the monthly return on the size, book-to-market factor, profitability factor and investment factor in month) as the independent variables. The significance levels are indicated by * and ** and correspond to a significance level of $5\\%$ and $1\\%$ respectively, using a two-tailed test. The 48 month abnormal return for the full sample is equal to ",round(CAL_table_all_bb["+48","CAL 5F"],2),"$\\%$, other values are reported in Table~\\ref{tbl:priorBuybacks}.",sep=""),
  label = "tbl:IndustriesBB_cal",
  bigtitleontop=T,
  metric1 = "AR", metric2 = "AR",
  #titleontop=T,
  scale=1,
  lastSpecial=T,
  dorotate=T
)

@


<<  eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=
latex_render_data_frame(
  pnl_matrix(remove_initialization_time(BUYBACK_DATA_NEW$long_all12mshort_risk_factors,min_date=FirstTrade)), 
  title = "Monthly and Yearly Five Factor Abnormal Rerurns of a strategy investing in all buybacks",
  caption="Monthly and yearly five-factor rolling hedged abnormal returns of an equally weighted (with monthly rebalancing) portfolio of all buybacks. The holding period for each buyback is 12 months per event.",
  label="tbl:allhedgedBB", 
  columns=NULL,
  bigtitleontop = T,
  show_rownames=TRUE,
  scale = 0.9,
  digits=1,
  lastSpecial=F,dorotate=F
)
@


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Cross Relations
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\clearpage
%\subsection{Enhanced U-index}
%\label{app:enhanced}


\small
<<  eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=
tmp = industry_BB_features[,c(1:4,9:10)]
if (colnames(tmp)[1] == "H Idsync.")
  colnames(tmp) <- paste(colnames(tmp), " (",1:ncol(tmp), ")",sep="")
latex_render_data_frame(
  round(tmp,1), 
  title = "Industry Characteristics",
  caption="Percentage of high and low idiosyncratic risk  and volatility companies for all industries for which we have at least 100 events in our sample.",
  label = "tbl:industriesR2Vol",
  columns=NULL,
  bigtitleontop = T,
  show_rownames=TRUE,
  scale = 1,
  digits=1,
  lastSpecial=F,dorotate=T
)
@
\normalsize



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% IDIOSYNCRATIC ANALYSIS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


<<   eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=
printLatexTable2(
  cbind(R2_IRATStableBB,R2_IRATStable_underBB)[reported_times,],
  cbind(R2_IRATStableBB_cal,R2_IRATStable_underBB_cal)[reported_times,],
  columns= c("Low Id.","High Id.","Low Id./High U-Ind.","Low Id./Low U-Ind.","High Id./High U-Ind.","High Id./Low U-Ind."),
  title="Buyback for Low and High idiosyncratic and for Low and and High U-index companies",
  title1 = "Panel A: IRATs Cumulative Abnormal Returns",
  title2 = "Panel B: Calendar Method Monthly Abnormal Returns",
  caption="This table presents the long-term abnormal return after open market repurchase announcements from the announcement date until $t$ months after, for low and high idiosyncratic and for low and  high U-index companies. Regardless of event study method and time horizon, the U-index works only for idiosyncratic companies. Panel~A reports monthly cumulative average abnormal returns (CAR) in percent using Ibbotson's (1975) returns across time and security (IRATS) method combined with the \\cite{FamaFrench2015a} five-factor model for the sample of firms that announced an open market share repurchase plus various subsamples. The following regression is run each event month~$j$:
\\begin{eqnarray*}
(R_{i,t} - R_{f,t}) &=& a_j + b_j (R_{m,t} - R_{f,t}) + c_j {SMB}_t + d_j {HML}_t + e_t {RMW}_t + f_t {CMA}_t + \\epsilon_{i,t},
\\end{eqnarray*}
where $R_{i,t}$ is the monthly return on security $i$ in the calendar month $t$ that corresponds to the event month $j$, with $j = 0$ being the month of the repurchase announcement. $R_{f,t}$ and $R_{m,t}$ are the risk-free rate and the return on the equally weighted CRSP index, respectively. ${SMB}_t$, ${HML_t}$, ${RMW}_t$, ${CMA}_t$ are the monthly returns on the size, book-to-market factor, profitability factor and investment factor in month $t$, respectively. The numbers reported are sums of the intercepts of cross-sectional regressions over the relevant event-time-periods expressed in percentage terms. The standard error (denominator of the $t$-statistic) for a window is the square root of the sum of the squares of the monthly standard errors. Panel~B reports monthly average abnormal returns (AR) of equally weighted Calendar Time portfolios using the \\cite{FamaFrench2015a} five-factor model. In this method, event firms that have announced an open market buyback in the last calendar months form the basis of the calendar month portfolio. A single time-series regression is run with the excess returns of the calendar portfolio as the dependent variable and the returns of five factors as the independent variables. The significance levels are indicated by * and ** and correspond to a significance level of $5\\%$ and $1\\%$ respectively, using a two-tailed test.",
label = "tbl:IdiosyncraticunderBB",
bigtitleontop=T,
titleontop=T,
metric1 = "CAR",
metric2 = "AR",
scale=1,
lastSpecial=T,
dorotate=T
)

@

\clearpage



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% VOL ANALYSIS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

<<   eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=
printLatexTable2(
  cbind(VOL_IRATStableBB,VOL_IRATStable_underBB)[reported_times,],
  cbind(VOL_IRATStableBB_cal,VOL_IRATStable_underBB_cal)[reported_times,],
  columns= c("Low Vol.","High Vol.","Low Vol./High U-ind.","Low Vol./Low U-ind.","High Vol./High U-ind.","High Vol./Low U-ind."),
  title="Buyback for Low and High Volatility and  for Low and and High U-index companies",
  title1 = "Panel A: IRATs Cumulative Abnormal Returns",
  title2 = "Panel B: Calendar Method Monthly Abnormal Returns",
  caption="This table presents the long-term abnormal return after open market repurchase announcements from the announcement date until $t$ months after, for low and high volatility and  for low and  high U-index companies.  Regardless of event study method and time horizon, the U-index works only for idiosyncratic companies. Panel~A reports monthly cumulative average abnormal returns (CAR) in percent using Ibbotson's (1975) returns across time and security (IRATS) method combined with the \\cite{FamaFrench2015a} five-factor model for the sample of firms that announced an open market share repurchase plus various subsamples. The following regression is run each event month~$j$:
\\begin{eqnarray*}
(R_{i,t} - R_{f,t}) &=& a_j + b_j (R_{m,t} - R_{f,t}) + c_j {SMB}_t + d_j {HML}_t + e_t {RMW}_t + f_t {CMA}_t + \\epsilon_{i,t},
\\end{eqnarray*}
where $R_{i,t}$ is the monthly return on security $i$ in the calendar month $t$ that corresponds to the event month $j$, with $j = 0$ being the month of the repurchase announcement. $R_{f,t}$ and $R_{m,t}$ are the risk-free rate and the return on the equally weighted CRSP index, respectively. ${SMB}_t$, ${HML_t}$, ${RMW}_t$, ${CMA}_t$ are the monthly returns on the size, book-to-market factor, profitability factor and investment factor in month $t$, respectively. The numbers reported are sums of the intercepts of cross-sectional regressions over the relevant event-time-periods expressed in percentage terms. The standard error (denominator of the $t$-statistic) for a window is the square root of the sum of the squares of the monthly standard errors. Panel~B reports monthly average abnormal returns (AR) of equally weighted Calendar Time portfolios using the \\cite{FamaFrench2015a} five-factor model. In this method, event firms that have announced an open market buyback in the last calendar months form the basis of the calendar month portfolio. A single time-series regression is run with the excess returns of the calendar portfolio as the dependent variable and the returns of five factors as the independent variables. The significance levels are indicated by * and ** and correspond to a significance level of $5\\%$ and $1\\%$ respectively, using a two-tailed test.",
label = "tbl:VOLunderBB",
bigtitleontop=T,
titleontop=T,
metric1 = "CAR",
metric2 = "AR",
scale=1,
lastSpecial=T,
dorotate=T
)
@



<<   eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=
rownames(Under_IdioBB)[1:2] <- c("high U-index", "low U-index")
latex_render_data_frame(
  round(Under_IdioBB[1:6,1:4],1), 
  title = "Relations across firm characteristics for Buybacks",
  caption="Relation between Under/Overvaluation, High/Low Idiosyncratic Risk, High/Low volatilityfor buybacks. Numbers indicate percentage of firms in the row that are also categorized as noted in the columns.",
  label = "tbl:underidioallBB",
  columns=NULL,
  bigtitleontop = T,
  show_rownames=TRUE,
  scale = 0.9,
  digits=1,
  lastSpecial=F,dorotate=F
)



latex_render_data_frame(
  round(Under_IdioBB_cor,2), 
  title = "Correlations of Buybacks Characteristics",
  caption="Correlation between the three buybacks characteristics considered: Idiosyncratic score (percentile across all CRSP companies of firm's $1-R^2$, 0 to 1), Volatility score  (percentile across all CRSP companies, 0 to 1) and U-index score (0 to 15). All scores are defined using the universe of all CRSP companies at the time of the announcement with data up to the month before the announcement.",
  label = "tbl:underidioallBBcor",
  columns=NULL,
  bigtitleontop = T,
  show_rownames=TRUE,
  scale = 0.9,
  digits=2,
  lastSpecial=F,dorotate=F
)


@


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% NEW INDEX
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

<<  eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=
rownames(EU_relations)[1] <- "Low Leverage"
rownames(EU_relations)[2] <- "High Leverage"
latex_render_data_frame(
  round(EU_relations,1), 
  title = "EU relations with Firm Characteristics",
  caption="Firm characteristics for each of the 7 EU-index samples. Percentages indicated for all but the last 3 rows, and averages for the last 3 rows. We consider firm \\textit{leverage}, based on data the year before announcement, defined as the ratio $debt/(debt+equity)$. \\textit{Missed (Beat) EPS} measures the percentage of firms in the specific EU index category that missed (beat) the last EPS consensus analyst forecast before the buyback announcement. \\textit{ISS later} measures the percentage of firms that announced an equity issue within 48 months after the buyback announcement. Next, we measure the percentage of buybacks financed with cash (\\textit{CASH}) when the data is available and whether the reported purpose included the term \\textit{Undervalued},  \\textit{Enhance Shareholder Value} or \\textit{stock option plan}. Market Cap. is in millions, BE/ME Score is from 1, for firms below the $4^{th}$ Fama-French BE/ME breakpoint, to 5 for firms above the $16^{th}$. Percentage Shares is the percentage shares authorized at announcement.",
  label = "tbl:EUrelations",
  columns=NULL,
  bigtitleontop = T,
  show_rownames=TRUE,
  scale = 1,
  digits=1,
  lastSpecial=F,dorotate=F
)
@



<<  eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=

printLatexTable2(
  EU_IRATStable_bb[reported_times,1:(3*4)],
  EU_IRATStable_bb[reported_times,13:(3*7)],
  columns = c("EU-index 0", "EU-index 1","EU-index 2","EU-index 3"),
  columns2 = c("EU-index 4","EU-index 5","EU-index 6"),
  title="Buyback announcements IRATS for all EU-index Values",
  caption="IRATS five factor cumulative abnormal returns after open market repurchase announcements for each Enhanced Undervaluation Index value from 0 to 6.
 We calculate the EU-index simply as the sum of three numbers:  high Peyer and Vermaelen (2009) U-index terms get a score of 2, low get a 0; high idiosyncratic terms get a score of 2, low get a 0; and high volatility terms get a score of 2, low get a 0.  Firms that get neither 0 nor 2 (hence are in the middle of the range) get a score of 1 for each of these 3 scores. For each EU-index value, we report the monthly cumulative average abnormal returns (CAR) in percent using Ibbotson's (1975) returns across time and security (IRATS) method combined with the \\cite{FamaFrench2015a} five-factor model for the sample of firms that announced an open market share repurchase plus various subsamples. The following regression is run each event month~$j$:
\\begin{eqnarray*}
(R_{i,t} - R_{f,t}) &=& a_j + b_j (R_{m,t} - R_{f,t}) + c_j {SMB}_t + d_j {HML}_t + e_t {RMW}_t + f_t {CMA}_t + \\epsilon_{i,t},
\\end{eqnarray*}
where $R_{i,t}$ is the monthly return on security $i$ in the calendar month $t$ that corresponds to the event month $j$, with $j = 0$ being the month of the repurchase announcement. $R_{f,t}$ and $R_{m,t}$ are the risk-free rate and the return on the equally weighted CRSP index, respectively. ${SMB}_t$, ${HML_t}$, ${RMW}_t$, ${CMA}_t$ are the monthly returns on the size, book-to-market factor, profitability factor and investment factor in month $t$, respectively. The numbers reported are sums of the intercepts of cross-sectional regressions over the relevant event-time-periods expressed in percentage terms. The standard error (denominator of the $t$-statistic) for a window is the square root of the sum of the squares of the monthly standard errors.",
label = "tbl:EUunderBB",
bigtitleontop=T,
titleontop=T,
metric1="CAR",metric2="CAR",
scale=1,
lastSpecial=T,
dorotate=T
)

printLatexTable2(
  EU_CALtable_bb[reported_times,1:(3*4)],
  EU_CALtable_bb[reported_times,13:(3*7)],
  columns = c("EU-index 0", "EU-index 1","EU-index 2","EU-index 3"),
  columns2 = c("EU-index 4","EU-index 5","EU-index 6"),
  title="Buyback announcements Calendar Time for all EU-index Values",
  caption="IRATS five factor cumulative abnormal returns after open market repurchase announcements for each Enhanced Undervaluation Index value from 0 to 6.
 We calculate the EU-index simply as the sum of three numbers:  high Peyer and Vermaelen (2009) U-index terms get a score of 2, low get a 0; high idiosyncratic terms get a score of 2, low get a 0; and high volatility terms get a score of 2, low get a 0.  Firms that get neither 0 nor 2 (hence are in the middle of the range) get a score of 1 for each of these 3 scores. For each EU-index value, we report the monthly average abnormal returns (AR) of equally weighted Calendar Time portfolios using the \\cite{FamaFrench2015a} five-factor model. In this method, event firms that have announced an open market buyback in the last calendar months form the basis of the calendar month portfolio. A single time-series regression is run with the excess returns of the calendar portfolio as the dependent variable and the returns of five factors (the difference between the risk-free rate and the return on the equally weighted CRSP index, the monthly return on the size, book-to-market factor, profitability factor and investment factor in month) as the independent variables. The significance levels are indicated by * and ** and correspond to a significance level of $5\\%$ and $1\\%$ respectively, using a two-tailed test.",
 label = "tbl:EUunderBBcal",
 bigtitleontop=T,
 titleontop=T,
 metric1="AR",metric2="AR",
 scale=1,
 lastSpecial=T,
 dorotate=T
)
@

\clearpage

<<   eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=


printLatexTable2(
  EIRATS_table_undervaluation_time_bb[reported_times,1:(3*4)],
  EIRATS_table_undervaluation_time_bb[reported_times,13:(3*8)],
  columns = c("1985-1990: High-EU", "Low-EU", "1991-2000: High-EU", "Low-EU"),
  columns2 = c("2001-2014: High-EU", "Low-EU", "2008-2014: High-EU", "Low-EU"),
  title="Long-run IRATS abnormal returns after open market repurchase announcements for low and high EU-index companies over different time periods.",
  caption="Long-run abnormal returns five factor monthly abnormal returns after open market repurchase announcements for low and high Enhanced Undervaluation (EU) Index companies over different time periods. We define low EU-index firms those for which the EU-index is 0-1, and high for which it is 5-6 (note that the index takes values from 0 to 6). IRATS five factor cumulative abnormal returns after open market repurchase announcements for each EU-index value from 0 to 6. We calculate the EU-index simply as the sum of three numbers:  high Peyer and Vermaelen (2009) U-index terms get a score of 2, low get a 0; high idiosyncratic terms get a score of 2, low get a 0; and high volatility terms get a score of 2, low get a 0.  Firms that get neither 0 nor 2 (hence are in the middle of the range) get a score of 1 for each of these 3 scores. For each EU-index value, we report the monthly cumulative average abnormal returns (CAR) in percent using Ibbotson's (1975) returns across time and security (IRATS) method combined with the \\cite{FamaFrench2015a} five-factor model for the sample of firms that announced an open market share repurchase plus various subsamples. The following regression is run each event month~$j$:
\\begin{eqnarray*}
(R_{i,t} - R_{f,t}) &=& a_j + b_j (R_{m,t} - R_{f,t}) + c_j {SMB}_t + d_j {HML}_t + e_t {RMW}_t + f_t {CMA}_t + \\epsilon_{i,t},
\\end{eqnarray*}
where $R_{i,t}$ is the monthly return on security $i$ in the calendar month $t$ that corresponds to the event month $j$, with $j = 0$ being the month of the repurchase announcement. $R_{f,t}$ and $R_{m,t}$ are the risk-free rate and the return on the equally weighted CRSP index, respectively. ${SMB}_t$, ${HML_t}$, ${RMW}_t$, ${CMA}_t$ are the monthly returns on the size, book-to-market factor, profitability factor and investment factor in month $t$, respectively. The numbers reported are sums of the intercepts of cross-sectional regressions over the relevant event-time-periods expressed in percentage terms. The standard error (denominator of the $t$-statistic) for a window is the square root of the sum of the squares of the monthly standard errors.",
label = "tbl:EUTimeUnderBB",
bigtitleontop=T,
titleontop=T,
metric1="CAR",metric2="CAR",
scale=1,
lastSpecial=T,
dorotate=T
)

printLatexTable2(
  ECAL_table_undervaluation_time_bb[reported_times,1:(3*4)],
  ECAL_table_undervaluation_time_bb[reported_times,13:(3*8)],
  columns = c("1985-1990: High-EU", "Low-EU", "1991-2000: High-EU", "Low-EU"),
  columns2 = c("2001-2014: High-EU", "Low-EU", "2008-2014: High-EU", "Low-EU"),
  title="Calendar method monthly abnormal returns after open market repurchase announcements for low and high EU-index companies over different time periods.",
  caption="Long-term monthly abnormal returns after open market repurchase announcements for low and high Enhanced Undervaluation (EU) Index companies over different time periods. We define low EU-index firms those for which the EU-index is 0-1, and high for which it is 5-6 (note that the index takes values from 0 to 6).  We calculate the EU-index simply as the sum of three numbers:  high Peyer and Vermaelen (2009) U-index terms get a score of 2, low get a 0; high idiosyncratic terms get a score of 2, low get a 0; and high volatility terms get a score of 2, low get a 0.  Firms that get neither 0 nor 2 (hence are in the middle of the range) get a score of 1 for each of these 3 scores. For each EU-index value, we report the monthly average abnormal returns (AR) of equally weighted Calendar Time portfolios using the \\cite{FamaFrench2015a} five-factor model. In this method, event firms that have announced an open market buyback in the last calendar months form the basis of the calendar month portfolio. A single time-series regression is run with the excess returns of the calendar portfolio as the dependent variable and the returns of five factors (the difference between the risk-free rate and the return on the equally weighted CRSP index, the monthly return on the size, book-to-market factor, profitability factor and investment factor in month) as the independent variables. The significance levels are indicated by * and ** and correspond to a significance level of $5\\%$ and $1\\%$ respectively, using a two-tailed test.",
  label = "tbl:EUTimeUnderBBcal",
  bigtitleontop=T,
  titleontop=T,
  metric1="AR",metric2="AR",
  scale=1,
  lastSpecial=T,
  dorotate=T
)
@


\clearpage

<<  eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=
if (0){
  latex_render_data_frame(
    pnl_matrix(remove_initialization_time(High_EU_BB_Hedged,min_date=FirstTrade)), 
    title = "Monthly and Yearly Five Factor Abnormal Rerurns of a strategy investing in all high EU-index buybacks",
    caption="Monthly and yearly  five-factor rolling hedged abnormal returns of an equally weighted (with monthly rebalancing) portfolio of all high EU-index buybacks only. Holding period for each buyback is 12 months per event.",
    label="tbl:EUhedgedBB", 
    columns=NULL,
    bigtitleontop = T,
    show_rownames=TRUE,
    scale = 0.9,
    digits=1,
    lastSpecial=F,dorotate=F
  )
}
@

%\clearpage

%########################################################################################################
%## REPORT.RNW SPECIAL CODE:
%########################################################################################################

<<  eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=
#cat all the tables for the individual variables
for(i in 1:6) {
  sec <- eval(parse(text=paste("sec",i,sep="")))
  if(!is.null(sec)) {
    cat(sec$car_table)
    cat(sec$under_table)
  }
}
#cat the U-index table and others
cat(secU$car_table)
cat(secU$CEU_IRATStable_bb_latex)
cat(secU$CEU_CALtable_bb_latex)

@

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Special table combining industry characteristics and High/Low of all additional variables
\small
<<  eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=
if (0){
  tmp = generate_industry_table(sec1,sec2,sec3,sec5,sec5,sec6)
  latex_render_data_frame(
    round(tmp,1), 
    title = "Industry Characteristics",
    caption="Percentage of high and low subset companies for all industries for which we have at least 100 events in our sample.",
    label = "tbl:CEUrelations",
    columns=NULL,
    bigtitleontop = T,
    show_rownames=TRUE,
    scale = 1,
    digits=1,
    lastSpecial=F,dorotate=T
  )
}
@
\normalsize

<<  eval = TRUE, echo=FALSE,message=FALSE,fig.pos='h',results='asis' >>=
if (0){
  rownames(secU$Under_IdioBB2)[1:2] <- c("high U-index", "low U-index")
  latex_render_data_frame(
    round(secU$Under_IdioBB2[1:6,1:4],1), 
    title = "Relations across firm characteristics for Buybacks",
    caption="Relation between Under/Overvaluation and High/Low samples of the additional variables for buybacks. Numbers indicate percentage of firms in the row that are also categorized as noted in the columns.",
    label = "tbl:underidioallBB2",
    columns=NULL,
    bigtitleontop = T,
    show_rownames=TRUE,
    scale = 0.9,
    digits=1,
    lastSpecial=F,dorotate=F
  )
  
  
  latex_render_data_frame(
    round(secU$Under_IdioBB_cor2,2), 
    title = "Correlations of Buybacks Characteristics",
    caption="Correlation between all of the buybacks characteristics considered and the U-index score. All scores are defined using the universe of all CRSP companies at the time of the announcement with data up to the month before the announcement.",
    label = "tbl:underidioallBBcor2",
    columns=NULL,
    bigtitleontop = T,
    show_rownames=TRUE,
    scale = 0.9,
    digits=2,
    lastSpecial=F,dorotate=F
  )
}
@

%########################################################################################################
%## REPORT.RNW SPECIAL CODE ENDS HERE
%########################################################################################################

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%XXXXXXX NOW ALL FIGURES
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\clearpage
\begin{figure}[H]
\centering
<<   fig.width=10, fig.height=7, out.width='\\textwidth', echo=F >>=
par(mfrow=c(2,1), mar=c(2.2,4.5,2.2,4.5))

number_eventsBB = table(format(BUYBACK_DATA_NEW$DATASET$SDC$Event.Date[BUYBACK_DATA_NEW$DATASET$SDC$Event.Date >= FirstTrade], "%Y"))
market_index = 100*(1+cumprod(1+Market_Monthly[names(Market_Monthly) >= "1985-01-01"]))
market_index = market_index[which(str_sub(names(market_index), start = 6, end = 7)=="12")]
names(market_index) <- str_sub(names(market_index), start = 1, end = 4)
df.bar <- barplot(number_eventsBB,col=c("grey"),main = "Panel A: Buyback Announcements", ylab = "Announcements", xlab = "Years",las=2,space=0.5, cex.names=0.6)
par(new = TRUE)
plot(market_index,type="l", lwd = 1.5, axes = FALSE, xlab = "", ylab = "")
points(market_index, pch=1,  lwd=1.5)
axis(side=4, at = pretty(range(market_index)))
mtext("Market Index", side=4, line=3)
for (iter in 1:floor(max(number_eventsBB)/100))
  abline(h = 100*iter)

number_eventsISS = table(format(ISSUERS_DATA$DATASET$SDC$Event.Date[ISSUERS_DATA$DATASET$SDC$Event.Date >= FirstTrade], "%Y"))
market_index = 100*(1+cumprod(1+Market_Monthly[names(Market_Monthly) > "1985-01-01"]))
market_index = market_index[which(str_sub(names(market_index), start = 6, end = 7)=="12")]
names(market_index) <- str_sub(names(market_index), start = 1, end = 4)
df.bar <- barplot(number_eventsISS,col=c("grey"),main = "Panel B: Equity SEO Announcements", ylab = "Announcements", xlab = "Years",las=2,space=0.5, cex.names=0.6)
par(new = TRUE)
plot(market_index,type="l", lwd = 1.5, axes = FALSE, xlab = "", ylab = "")
points(market_index, pch=1,  lwd=1.5)
axis(side=4, at = pretty(range(market_index)))
mtext("Market Index", side=4, line=3)
for (iter in 1:floor(max(number_eventsISS)/50))
  abline(h = 50*iter)
@
\caption{Buyback and equity announcements. Number of announcements per year. Panel~A: Buyback announcements; Panel~B: Equity SEO announcements. Solid line and right hand axis shows the $S\&P$ index at the end of each year, starting from 100 in January 1985. Buyback activity rises prior to stock market increases and tends to fall afterwards. Also note the structural decline in equity since 2000. }
\label{fig:liveevents}
\end{figure}

\clearpage

\begin{figure}[H]
\centering
<<  fig.width=10, fig.height=5, out.width='\\textwidth', echo=F >>=
#par(mfrow=c(2,1), mar=c(2.3,4,2.3,4))
#valuation_index_bb[which(valuation_index_bb==2)]<-3 # there is one company here. need to check why
tmp = table(valuation_index_bb)
tmp = structure(as.numeric(tmp), .Names = names(tmp))
barplot(tmp,main = "", ylab = "Number of Events", xlab = "",las=2,space=0.5, cex.names=0.8)
#tmp = table(valuation_index_iss)
#tmp = structure(as.numeric(tmp), .Names = names(tmp))
#barplot(tmp,main = "SEOs", ylab = "Number of Announcements", xlab = "SEO Overvaluation Index",las=2,space=0.5, cex.names=0.8)
rm("tmp")
@
\caption{Distribution of the Undervaluation Index of all buyback events.}
\label{fig:undervaluationindex}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\clearpage

\begin{figure}[H]
\centering
<< fig.width=10, fig.height=6, out.width='\\textwidth', echo=F >>=
par(mfrow=c(2,2), mar=c(2.3,4,2.3,4))

IRATS_table_all_bb_plot = IRATS_table_all_bb
IRATS_table_all_bb_plot[rownames(IRATS_table_all_bb_plot) %in% as.character((-6):(-1)),c("CAR 3F","CAR 5F")] <- -IRATS_table_all_bb_plot[rownames(IRATS_table_all_bb_plot) %in% as.character((-6):(-1)),c("CAR 3F","CAR 5F")] 
IRATS_table_all_iss_plot = IRATS_table_all_iss
IRATS_table_all_iss_plot[rownames(IRATS_table_all_iss_plot) %in% as.character((-6):(-1)),c("CAR 3F","CAR 5F")] <- -IRATS_table_all_iss_plot[rownames(IRATS_table_all_iss_plot) %in% as.character((-6):(-1)),c("CAR 3F","CAR 5F")] 
IRATS_table_all_bb_undervaluation_plot = IRATS_table_all_bb_undervaluation
IRATS_table_all_bb_undervaluation_plot[rownames(IRATS_table_all_bb_undervaluation_plot) %in% as.character((-6):(-1)),c("U:CAR3F","O:CAR3F", "U:CAR5F","O:CAR5F")] <- -IRATS_table_all_bb_undervaluation_plot[rownames(IRATS_table_all_bb_undervaluation_plot) %in% as.character((-6):(-1)),c("U:CAR3F","O:CAR3F", "U:CAR5F","O:CAR5F")] 
IRATS_table_all_iss_undervaluation_plot = IRATS_table_all_iss_undervaluation
IRATS_table_all_iss_undervaluation_plot[rownames(IRATS_table_all_iss_undervaluation_plot) %in% as.character((-6):(-1)),c("U:CAR3F","O:CAR3F", "U:CAR5F","O:CAR5F")] <- -IRATS_table_all_iss_undervaluation_plot[rownames(IRATS_table_all_iss_undervaluation_plot) %in% as.character((-6):(-1)),c("U:CAR3F","O:CAR3F", "U:CAR5F","O:CAR5F")] 

ylimit = c(min(
  #IRATS_table_all_bb_plot[reported_times_plots,"CAR 3F"], 
  IRATS_table_all_bb_plot[reported_times_plots,"CAR 5F"], 
  #IRATS_table_all_bb_undervaluation_plot[reported_times_plots,"U:CAR3F"], 
  #IRATS_table_all_bb_undervaluation_plot[reported_times_plots,"O:CAR3F"], 
  IRATS_table_all_bb_undervaluation_plot[reported_times_plots,"U:CAR5F"], 
  IRATS_table_all_bb_undervaluation_plot[reported_times_plots,"O:CAR5F"]), 
  max(
    #IRATS_table_all_bb_plot[reported_times_plots,"CAR 3F"], 
    IRATS_table_all_bb_plot[reported_times_plots,"CAR 5F"], 
    #IRATS_table_all_bb_undervaluation_plot[reported_times_plots,"U:CAR3F"], 
    #IRATS_table_all_bb_undervaluation_plot[reported_times_plots,"O:CAR3F"], 
    IRATS_table_all_bb_undervaluation_plot[reported_times_plots,"U:CAR5F"], 
    IRATS_table_all_bb_undervaluation_plot[reported_times_plots,"O:CAR5F"])
)

plot(IRATS_table_all_bb_plot[reported_times_plots,"CAR 5F"], ylim = ylimit,axes=FALSE, type = "l", ylab = "CAR", xlab="Months",main="A. Buybacks - All", lwd=1.4)
axis(1,at=plot_tickers,labels=plot_xlabels,cex.axis=0.8,las=3)
axis(2,cex.axis=1.1)
#lines(IRATS_table_all_bb_plot[reported_times_plots,"CAR 5F"],  lty = 2,lwd=1.4)
abline(v=which(reported_times_plots == "0"), lwd=0.5)
abline(h=0, lwd=0.5)

plot(IRATS_table_all_bb_undervaluation_plot[reported_times_plots,"U:CAR5F"], ylim = ylimit,axes=FALSE, type = "l", ylab = "CAR", xlab="Months",main="C. Buybacks - high/low U-index", lwd=1.4)
axis(1,at=plot_tickers,labels=plot_xlabels,cex.axis=0.8,las=3)
axis(2,cex.axis=1.1)
#tmp = rep(NA,length(reported_times_plots)); tmp[plot_tickers] <- IRATS_table_all_bb_undervaluation_plot[plot_tickers,"U:CAR3F"]
#points(tmp, pch=0)
#lines(IRATS_table_all_bb_undervaluation_plot[reported_times_plots,"O:CAR3F"],lwd=1.6)
#tmp = rep(NA,length(reported_times_plots)); tmp[plot_tickers] <- IRATS_table_all_bb_undervaluation_plot[plot_tickers,"O:CAR3F"]
#points(tmp, pch=3)
#lines(IRATS_table_all_bb_undervaluation_plot[reported_times_plots,"U:CAR5F"],lty = 3, lwd=1.6)
#tmp = rep(NA,length(reported_times_plots)); tmp[plot_tickers] <- IRATS_table_all_bb_undervaluation_plot[plot_tickers,"U:CAR5F"]
#points(tmp, pch=0)
lines(IRATS_table_all_bb_undervaluation_plot[reported_times_plots,"O:CAR5F"],  lty = 3,lwd=1.6)
#tmp = rep(NA,length(reported_times_plots)); tmp[plot_tickers] <- IRATS_table_all_bb_undervaluation_plot[plot_tickers,"O:CAR5F"]
#points(tmp, pch=3)
abline(v=which(reported_times_plots == "0"), lwd=0.5)
abline(h=0, lwd=0.5)

# SEOs
ylimit = c(min(
  #IRATS_table_all_iss_plot[reported_times_plots,"CAR 3F"], 
  IRATS_table_all_iss_plot[reported_times_plots,"CAR 5F"]#, 
  #IRATS_table_all_iss_undervaluation_plot[reported_times_plots,"U:CAR3F"], 
  #IRATS_table_all_iss_undervaluation_plot[reported_times_plots,"O:CAR3F"], 
  #IRATS_table_all_iss_undervaluation_plot[reported_times_plots,"U:CAR5F"], 
  #IRATS_table_all_iss_undervaluation_plot[reported_times_plots,"O:CAR5F"]
), 
max(
  #IRATS_table_all_iss_plot[reported_times_plots,"CAR 3F"], 
  IRATS_table_all_iss_plot[reported_times_plots,"CAR 5F"]#, 
  #IRATS_table_all_iss_undervaluation_plot[reported_times_plots,"U:CAR3F"], 
  #IRATS_table_all_iss_undervaluation_plot[reported_times_plots,"O:CAR3F"], 
  #IRATS_table_all_iss_undervaluation_plot[reported_times_plots,"U:CAR5F"], 
  #IRATS_table_all_iss_undervaluation_plot[reported_times_plots,"O:CAR5F"]
)
)

plot(IRATS_table_all_iss_plot[reported_times_plots,"CAR 5F"], ylim = ylimit,axes=FALSE, type = "l", ylab = "CAR", xlab="Months",main="B. SEOs - All", lwd=1.4)
axis(1,at=plot_tickers,labels=plot_xlabels,cex.axis=0.8,las=3)
axis(2,cex.axis=1.1)
#lines(IRATS_table_all_iss_plot[reported_times_plots,"CAR 5F"],  lty = 2,lwd=1.4)
abline(v=which(reported_times_plots == "0"), lwd=0.5)
abline(h=0, lwd=0.5)

if (0){
  plot(IRATS_table_all_iss_undervaluation_plot[reported_times_plots,"U:CAR5F"], ylim = ylimit,axes=FALSE, type = "l", ylab = "CAR", xlab="Months",main="SEOs - Under/Over-valuation", lwd=1.4)
  axis(1,at=plot_tickers,labels=plot_xlabels,cex.axis=0.8,las=3)
  axis(2,cex.axis=1.1)
  #tmp = rep(NA,length(reported_times_plots)); tmp[plot_tickers] <- IRATS_table_all_iss_undervaluation_plot[plot_tickers,"U:CAR3F"]
  #points(tmp, pch=0)
  #lines(IRATS_table_all_iss_undervaluation_plot[reported_times_plots,"O:CAR3F"],lwd=1.6)
  #tmp = rep(NA,length(reported_times_plots)); tmp[plot_tickers] <- IRATS_table_all_iss_undervaluation_plot[plot_tickers,"O:CAR3F"]
  #points(tmp, pch=3)
  #lines(IRATS_table_all_iss_undervaluation_plot[reported_times_plots,"U:CAR5F"],lty = 3, lwd=1.6)
  #tmp = rep(NA,length(reported_times_plots)); tmp[plot_tickers] <- IRATS_table_all_iss_undervaluation_plot[plot_tickers,"U:CAR5F"]
  #points(tmp, pch=0)
  lines(IRATS_table_all_iss_undervaluation_plot[reported_times_plots,"O:CAR5F"],  lty = 3,lwd=1.6)
  #tmp = rep(NA,length(reported_times_plots)); tmp[plot_tickers] <- IRATS_table_all_iss_undervaluation_plot[plot_tickers,"O:CAR5F"]
  #points(tmp, pch=3)
  abline(v=which(reported_times_plots == "0"), lwd=0.5)
  abline(h=0, lwd=0.5)
}
@
\caption{Long-run five factors cumulative average abnormal returns (CAR) of buyback and SEO portfolios. The x-axis indicates months from the date of the event announcement. Panel~A shows all buyback events, whereas Panel C shows all high (solid line) and low (dashed lines) U-index buyback events. Panel~B includes all SEOs.}
\label{fig:pastall}
\end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CROSS-EVENTS ANALYSIS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\clearpage

%\subsection{Combining Equity Issues and Stock Repurchases}
%\label{app:combine}

\begin{figure}[H]
\centering
<< BBISSevents, fig.width=10, fig.height=6, out.width='\\textwidth', echo=F >>=
#par(mfrow=c(2,1), mar=c(3.8,4,3.8,4))

market_index = 100*(1+cumprod(1+Market_Monthly[names(Market_Monthly) >= "1985-01-01"]))
market_index = market_index[which(str_sub(names(market_index), start = 6, end = 7)=="12")]
names(market_index) <- str_sub(names(market_index), start = 1, end = 4)
df.bar <- barplot(BB_with_ISS_later_total,col=c("grey"),main = "", ylab = "Percent", xlab = "Years",las=2,space=0.5, cex.names=0.8)
for (iter in 1:floor(max(BB_with_ISS_later_total)/5))
  abline(h = 5*iter)
#par(new = TRUE)
#plot(market_index,type="l", col="red", lwd = 4, lty=3,axes = FALSE, xlab = "", ylab = "")
#points(market_index, pch=1, col="red", lwd=2)
#axis(side=4, at = pretty(range(market_index)))
#mtext("Market Index", side=4, line=3)

if (0){
  df.bar <- barplot(ISS_with_BB_later_total,col=c("grey"),main = "Issues with Follow-up Buyback", ylab = "Percent", xlab = "Years",las=2,space=0.5, cex.names=0.8)
  for (iter in 1:floor(max(ISS_with_BB_later_total)/5))
    abline(h = 5*iter)
  par(new = TRUE)
  plot(market_index,type="l", col="red", lwd = 4, lty=3,axes = FALSE, xlab = "", ylab = "")
  points(market_index, pch=1, col="red", lwd=2)
  axis(side=4, at = pretty(range(market_index)))
  mtext("Market Index", side=4, line=3)
}
@
\caption{Buybacks with a follow-up equity issue within 48 months. We show the percent of announced buyback events each year, that had a follow-up issue within 48 months after the event. The average percentage is \Sexpr{round(mean(BB_with_ISS_later_total),1)}$\%$ and there are only \Sexpr{sum(BB_with_ISS_later_total > 10)} years (1989 and 1990) where the percentage is larger than $10\%$.
%Top figure is buybacks and bottom is SEOs.
}
\label{fig:BBISSevents}
\end{figure}

\clearpage

\begin{figure}[H]
\centering
<< BBISSpnl, fig.width=10, fig.height=7, out.width='\\textwidth', echo=F >>=
reported_times_plots_tmp = reported_times_plots
reported_times_plots = reported_times_plots[8:length(reported_times_plots)]

#par(mfrow=c(2,2), mar=c(3.8,4,3.8,4))
par(mfrow=c(2,1), mar=c(3,4,3,4))

ylimit = c(min(Exit_on_SEO_Abn_table[reported_times_plots,1], Exit_on_SEO_Abn_table[reported_times_plots,4]), 
           max(Exit_on_SEO_Abn_table[reported_times_plots,1], Exit_on_SEO_Abn_table[reported_times_plots,4]))
plot(Exit_on_SEO_Abn_table[reported_times_plots,1], ylim = ylimit,axes=FALSE, type = "l", ylab = "CAR", xlab="Months",main="Panel A: Buybacks with SEO IRATS CAR", lwd=1.4)
axis(1,at=plot_tickers,labels=plot_xlabels,cex.axis=0.8,las=3)
axis(2,cex.axis=1.1)
lines(Exit_on_SEO_Abn_table[reported_times_plots,4],lty = 2,lwd=1.4)
abline(h=0, lwd=0.5)
abline(v=which(reported_times_plots == "0"), lwd=0.5)
legend(x="topleft",
       c("Post Buyback Issuance","No Post Buyback Issuance"),
       lty=c("solid","dashed"),
       lwd=c(2,2),
       cex=1,bg="white",inset=0.01)

if (0){
  ylimit = c(min(Exit_on_SEO_Abn_table_cal[reported_times_plots,1], Exit_on_SEO_Abn_table_cal[reported_times_plots,4]), 
             max(Exit_on_SEO_Abn_table_cal[reported_times_plots,1], Exit_on_SEO_Abn_table_cal[reported_times_plots,4]))
  plot(Exit_on_SEO_Abn_table_cal[reported_times_plots,1], ylim = ylimit,axes=FALSE, type = "l", ylab = "CAR", xlab="Months",main="Panel B: Buybacks with SEO: Calendar Method", lwd=1.4)
  axis(1,at=plot_tickers,labels=plot_xlabels,cex.axis=0.8,las=3)
  axis(2,cex.axis=1.1)
  lines(Exit_on_SEO_Abn_table_cal[reported_times_plots,4],lty = 2,lwd=1.4)
  abline(h=0, lwd=0.5)
  abline(v=which(reported_times_plots == "0"), lwd=0.5)
}

reported_times_plots = reported_times_plots_tmp

pnl_Exit_Hedged = BB_ISS_Exit_Hedged
pnl_NoExit_Hedged = BB_ISS_NoExit_Hedged[(which(pnl_NoExit_Hedged!=0)[1]):(tail(which(pnl_NoExit_Hedged!=0),1))]
plot(cumsum(100*pnl_NoExit_Hedged),type="l",ylab="CAR", xlab = "",main = "Panel B: Strategy Returns", axes = FALSE, ylim=c(min(c(100*cumsum(pnl_NoExit_Hedged),cumsum(100*pnl_Exit_Hedged))), max(c(cumsum(100*pnl_NoExit_Hedged),cumsum(100*pnl_Exit_Hedged)))), cex.lab=1.1)

axis(1,at=seq(1,length(pnl_NoExit_Hedged),length.out=10),labels=str_sub(names(pnl_NoExit_Hedged)[seq(1,length(pnl_NoExit_Hedged),length.out=10)], start = 1, end=4),cex.axis=0.8,las=3)
axis(2,cex.axis=1.1)
lines(cumsum(100*pnl_Exit_Hedged), lty = 2,lwd=1.4)
for (iter in floor(100*min(c(cumsum(pnl_NoExit_Hedged),cumsum(pnl_Exit_Hedged)))/100):floor(100*max(c(cumsum(pnl_NoExit_Hedged),cumsum(pnl_Exit_Hedged)))/100))
  abline(h = 100*iter)
#plot_crisis_dates(pnl_NoExit_Hedged) 
legend(x="topleft",
       c("Without Exit","With Exit"),
       lty=c("solid","dashed"),
       lwd=c(2,2),
       cex=1,bg="white",inset=0.01)

#### SEOs NOW (We combine the plots)
if (0){ 
  reported_times_plots_tmp = reported_times_plots
  reported_times_plots = reported_times_plots[8:length(reported_times_plots)]
  
  ylimit = c(min(Exit_on_BB_Abn_table[reported_times_plots,1], Exit_on_BB_Abn_table[reported_times_plots,4]), 
             max(Exit_on_BB_Abn_table[reported_times_plots,1], Exit_on_BB_Abn_table[reported_times_plots,4]))
  plot(Exit_on_BB_Abn_table[reported_times_plots,1], ylim = ylimit,axes=FALSE, type = "l", ylab = "CAR", xlab="Months",main="Panel B: SEO with Buyback IRATS CAR", lwd=1.4)
  axis(1,at=plot_tickers,labels=plot_xlabels,cex.axis=0.8,las=3)
  axis(2,cex.axis=1.1)
  lines(Exit_on_BB_Abn_table[reported_times_plots,4],lty = 2,lwd=1.4)
  abline(h=0, lwd=0.5)
  abline(v=which(reported_times_plots == "0"), lwd=0.5)
  
  if (0){
    ylimit = c(min(Exit_on_BB_Abn_table_cal[reported_times_plots,1], Exit_on_BB_Abn_table_cal[reported_times_plots,4]), 
               max(Exit_on_BB_Abn_table_cal[reported_times_plots,1], Exit_on_BB_Abn_table_cal[reported_times_plots,4]))
    plot(Exit_on_BB_Abn_table_cal[reported_times_plots,1], ylim = ylimit,axes=FALSE, type = "l", ylab = "CAR", xlab="Months",main="SEO with Buyback: Calendar", lwd=1.4)
    axis(1,at=plot_tickers,labels=plot_xlabels,cex.axis=0.8,las=3)
    axis(2,cex.axis=1.1)
    lines(Exit_on_BB_Abn_table_cal[reported_times_plots,4],lty = 2,lwd=1.4)
    abline(h=0, lwd=0.5)
    abline(v=which(reported_times_plots == "0"), lwd=0.5)
  }
  
  reported_times_plots = reported_times_plots_tmp
  
  pnl_Exit_Hedged = ISS_BB_Exit_Hedged
  pnl_NoExit_Hedged = ISS_BB_NoExit_Hedged
  plot(cumsum(100*pnl_NoExit_Hedged),type="l",ylab="CAR", xlab = "",main = "Strategy Returns",axes = FALSE, ylim=c(min(c(100*cumsum(pnl_NoExit_Hedged),cumsum(100*pnl_Exit_Hedged))), max(c(cumsum(100*pnl_NoExit_Hedged),cumsum(100*pnl_Exit_Hedged)))), cex.lab=1.1)
  axis(1,at=seq(1,length(pnl_NoExit_Hedged),length.out=10),labels=str_sub(names(pnl_NoExit_Hedged)[seq(1,length(pnl_NoExit_Hedged),length.out=10)], start = 1, end=4),cex.axis=0.8,las=3)
  axis(2,cex.axis=1.1)
  lines(cumsum(100*pnl_Exit_Hedged),lty = 2,lwd=1.4)
  for (iter in floor(100*min(c(cumsum(pnl_NoExit_Hedged),cumsum(pnl_Exit_Hedged)))/50):floor(100*max(c(cumsum(pnl_NoExit_Hedged),cumsum(pnl_Exit_Hedged)))/50))
    abline(h = 50*iter)
  #plot_crisis_dates(pnl_NoExit_Hedged) 
}
@
\caption{ Buybacks followed by equity issues within 48 months. 
Top Panel~A:  Five factor IRATS CAR for all buyback events that had (with hindsight) no subsequent SEO event within the 48 months post buyback announcement (solid line) versus those that did have (dashed line).  Bottom Panel~B: Abnormal (five-factor rolling hedged) returns of buybacks portfolio for only the \Sexpr{length(BB_with_ISS_later)} events for which there was a subsequent issue within 4 years. Dashed line is if we exit these positions the month after the subsequent SEO announcement. 
%(Average annual returns: \Sexpr{round(pnl_stats(BB_ISS_Exit_Hedged)[1],1)}$\%$, Sharpe ratio: \Sexpr{round(pnl_stats(BB_ISS_Exit_Hedged)[3],1)}), and solid line is if we do not (Average annual returns: \Sexpr{round(pnl_stats(BB_ISS_NoExit_Hedged)[1],1)}$\%$, Sharpe ratio: \Sexpr{round(pnl_stats(BB_ISS_NoExit_Hedged)[3],1)}). 
%{\bf Bottom Panel~B: Left:} Five factor IRATS CAR for all SEO events that had no subsequent buyback event within the 48 months post SEO announcement (black line) versus those that did have (dashed line). {\bf Right:} Abnormal (five-factor rolling hedged) returns of SEO portfolio for only the \Sexpr{length(ISS_with_BB_later)} events for which there was a subsequent buybacks announcement within 4 years. Dashed line is if we exit these positions  the month after the subsequent buyback announcement  (Average annual returns: \Sexpr{round(pnl_stats(ISS_BB_Exit_Hedged)[1],1)}$\%$, Sharpe ratio: \Sexpr{round(pnl_stats(ISS_BB_Exit_Hedged)[3],1)}), and solid line is if we do not (Average annual returns: \Sexpr{round(pnl_stats(ISS_BB_NoExit_Hedged)[1],1)}$\%$, Sharpe ratio: \Sexpr{round(pnl_stats(ISS_BB_NoExit_Hedged)[3],1)}). 
}
\label{fig:BBISSexit}
\end{figure}

\clearpage


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PORTFOLIO RETURNS ANALYSIS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{figure}[H]
\centering
<< ReturnsBB, fig.width=10, fig.height=9, out.width='\\textwidth', echo=F >>=
par(mfrow=c(2,1), mar=c(2.8,4,2.8,4))

all_ret_values = data.frame(
  market = cumsum(100*Market_Monthly[str_sub(names(Market_Monthly), start = 1, end = 7) %in% str_sub(names(remove_initialization_time(BUYBACK_DATA_NEW$pnl_returns_events_all_1M,min_date=FirstTrade)), start = 1, end = 7)]),
  #market = cumsum(100*Market_Daily[names(remove_initialization_time(BUYBACK_DATA_NEW$pnl_returns_events_all_1M,min_date=FirstTrade))]),
  months1 = cumsum(100*remove_initialization_time(BUYBACK_DATA_NEW$pnl_returns_events_all_1M,min_date=FirstTrade)),
  months3 = cumsum(100*remove_initialization_time(BUYBACK_DATA_NEW$pnl_returns_events_all_3M,min_date=FirstTrade)),
  months6 = cumsum(100*remove_initialization_time(BUYBACK_DATA_NEW$pnl_returns_events_all_6M,min_date=FirstTrade)),
  months12 = cumsum(100*remove_initialization_time(BUYBACK_DATA_NEW$pnl_returns_events_all_12M,min_date=FirstTrade)),
  months24 = cumsum(100*remove_initialization_time(BUYBACK_DATA_NEW$pnl_returns_events_all_24M,min_date=FirstTrade)),
  months36 = cumsum(100*remove_initialization_time(BUYBACK_DATA_NEW$pnl_returns_events_all_36M,min_date=FirstTrade)),
  months48 = cumsum(100*remove_initialization_time(BUYBACK_DATA_NEW$pnl_returns_events_all_48M,min_date=FirstTrade))
)
plot(all_ret_values$market, axes=FALSE, ylab="Cumulative Returns", xlab = "Time",ylim=c(min(as.vector(all_ret_values)), max(as.vector(all_ret_values))), main = "Panel A: Absolute Returns", cex.lab=1.1, lty = "dotdash", type = "l", lwd=2)
axis(1,at=seq(1,nrow(all_ret_values),length.out=10),labels=str_sub(rownames(all_ret_values)[seq(1,nrow(all_ret_values),length.out=10)], start = 1, end=4),cex.axis=0.8,las=3)
axis(2,cex.axis=1.1)
lines(all_ret_values$months1, lty="solid", lwd=2)
lines(all_ret_values$months3, lty="dashed", lwd=2)
lines(all_ret_values$months6, lty="dotted", lwd=3)
lines(all_ret_values$months12, lty="dotted", lwd=2.5)
lines(all_ret_values$months24, lty="dotted", lwd=2)
lines(all_ret_values$months36, lty="dotted", lwd=1.5)
lines(all_ret_values$months48, lty="dotted", lwd=1)
for (iter in 1:floor(max(as.vector(all_ret_values))/100))
  abline(h = 100*iter)
#plot_crisis_dates(all_ret_values)
legend(x="topleft",
       c("S&P500","1 Month","3 Months","12 Months","24 Months","36 Months","48 Months"),
       lty=c("dotdash","solid","dashed","dotted","dotted","dotted","dotted","dotted"),
       lwd=c(2,2,2,3,2.5,2,1.5,1),
       cex=1,bg="white",inset=0.01)

all_ret_values = data.frame(
  market = cumsum(100*Market_Monthly[str_sub(names(Market_Monthly), start = 1, end = 7) %in% str_sub(names(remove_initialization_time(BUYBACK_DATA_NEW$long_all1mshort_risk_factors,min_date=FirstTrade)), start = 1, end = 7)]),
  #market = cumsum(100*Market_Daily[names(remove_initialization_time(BUYBACK_DATA_NEW$long_all1mshort_risk_factors,min_date=FirstTrade))]),
  months1 = cumsum(100*remove_initialization_time(BUYBACK_DATA_NEW$long_all1mshort_risk_factors,min_date=FirstTrade)),
  months3 = cumsum(100*remove_initialization_time(BUYBACK_DATA_NEW$long_all3mshort_risk_factors,min_date=FirstTrade)),
  months6 = cumsum(100*remove_initialization_time(BUYBACK_DATA_NEW$long_all6mshort_risk_factors,min_date=FirstTrade)),
  months12 = cumsum(100*remove_initialization_time(BUYBACK_DATA_NEW$long_all12mshort_risk_factors,min_date=FirstTrade)),
  months24 = cumsum(100*remove_initialization_time(BUYBACK_DATA_NEW$long_all24mshort_risk_factors,min_date=FirstTrade)),
  months36 = cumsum(100*remove_initialization_time(BUYBACK_DATA_NEW$long_all36mshort_risk_factors,min_date=FirstTrade)),
  months48 = cumsum(100*remove_initialization_time(BUYBACK_DATA_NEW$long_all48mshort_risk_factors,min_date=FirstTrade))
)
plot(all_ret_values$market, axes=FALSE, ylab="CAR", xlab = "Time",ylim=c(min(as.vector(all_ret_values)), max(as.vector(all_ret_values))), main = "Panel B: Excess Returns", cex.lab=1.1, lty = "dotdash", type = "l", lwd=2)
axis(1,at=seq(1,nrow(all_ret_values),length.out=10),labels=str_sub(rownames(all_ret_values)[seq(1,nrow(all_ret_values),length.out=10)], start = 1, end=4),cex.axis=0.8,las=3)
axis(2,cex.axis=1.1)
lines(all_ret_values$months1, lty="solid", lwd=2)
lines(all_ret_values$months3, lty="dashed", lwd=2)
lines(all_ret_values$months6, lty="dotted", lwd=3)
lines(all_ret_values$months12, lty="dotted", lwd=2.5)
lines(all_ret_values$months24, lty="dotted", lwd=2)
lines(all_ret_values$months36, lty="dotted", lwd=1.5)
lines(all_ret_values$months48, lty="dotted", lwd=1)
for (iter in 1:floor(max(as.vector(all_ret_values))/50))
  abline(h = 50*iter)
abline(h = 50*6)
#plot_crisis_dates(all_ret_values)
#plot_crisis_dates(all_ret_values)
@ 
\caption{Cumulative returns of portfolios of all buybacks for different holding periods. Panel~A: Absolute returns; Panel~B: five-factor Rolling Hedged Abnormal returns using a rolling window of \Sexpr{hedge_months} months, lagging 1 month. Dotted-dashed line (e.g., lowest one in Panel~A) is the cumulative returns of the $S\&P$ Index, for comparison; solid line is with 1-month holding period, dashed line is with 3 months holding period; dotted lines are, from the most to the least dark ones, for 6, 12, 24, and 48 months holding periods. Note that the last few lines overlap to a large extend (especially in Panel~A).  We assume we enter each position \Sexpr{trading_day_after_announce} day after the corresponding event announcement. 
%Vertical lines indicate \Sexpr{BEAR_YEARS_text$dotcom[1]}, \Sexpr{BEAR_YEARS_text$dotcom[2]}, \Sexpr{BEAR_YEARS_text$financial1[1]}, and \Sexpr{BEAR_YEARS_text$financial1[2]}.
}
\label{fig:ReturnsBB}
\end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% INDUSTRIES ANALYSIS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\clearpage
%\subsection{Buybacks across Industries}
%\label{app:industries}

\begin{landscape}
\begin{figure}[H]
\centering
<<  fig.width=10, fig.height=5, echo=F >>=
df.bar <- barplot(industry_tableBB,col=c("grey"),main = "", ylab = "Buybacks", xlab = "",las=2,space=0.9, cex.names=0.6)
for (iter in 1:floor(max(industry_tableBB)/100))
  abline(h = 100*iter)
@
\caption{Number of buyback announcements per industry. }
\label{fig:industryeventsBB}
\end{figure}
\end{landscape}
%\begin{figure}[H]
%\centering
%<<  fig.width=10, fig.height=5, out.width='\\textwidth', echo=F >>=
%df.bar <- barplot(industry_tableISS,col=c("grey"),main = "", ylab = "Issues", xlab = "",las=2,space=0.9, cex.names=0.6)
%for (iter in 1:floor(max(industry_tableISS)/100))
%  abline(h = 100*iter)
%@
%\caption{Number of issue announcements per industry.  }
%\label{fig:industryeventsISS}
%\end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% IDIOSYNCRATIC ANALYSIS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\clearpage
%\subsection{Idiosyncratic Risk and Buybacks}
%\label{app:idiosync}

%\begin{figure}[H]
%\centering
<< R2thresholds, fig.width=7, fig.height=4, out.width='\\textwidth', echo=F >>=
if (0){
  #par(mfrow=c(2,1), mar=c(2.7,4.5,2.7,4.5))
  Market_Monthly_index = Market_Monthly
  names(Market_Monthly_index) <- paste(str_sub(names(Market_Monthly_index),start=1,end=4),str_sub(names(Market_Monthly_index),start=6,end=7),sep="")
  
  all_dates = paste(str_sub((BUYBACK_DATA_NEW$DATASET$SDC$Event.Date),start=1,end=4),str_sub((BUYBACK_DATA_NEW$DATASET$SDC$Event.Date),start=6,end=7),sep="")[High_Idiosyncr_eventsBB]
  tmp = BUYBACK_DATA_NEW$DATASET$SDC$Rsq_returns[High_Idiosyncr_eventsBB]
  names(tmp)<-all_dates
  R2_thresholds_up_plot = sapply(names(Market_Monthly_index), function(i){
    ifelse(sum(names(tmp) == i) > 1, mean(tmp[names(tmp) == i]),NA)
  })
  R2_thresholds_up_plot = R2_thresholds_up_plot[!is.na(R2_thresholds_up_plot)]
  all_dates = paste(str_sub((BUYBACK_DATA_NEW$DATASET$SDC$Event.Date),start=1,end=4),str_sub((BUYBACK_DATA_NEW$DATASET$SDC$Event.Date),start=6,end=7),sep="")[Low_Idiosyncr_eventsBB]
  tmp = BUYBACK_DATA_NEW$DATASET$SDC$Rsq_returns[Low_Idiosyncr_eventsBB]
  names(tmp)<-all_dates
  R2_thresholds_down_plot = sapply(names(Market_Monthly_index), function(i){
    ifelse(sum(names(tmp) == i) > 1, mean(tmp[names(tmp) == i]),NA)
  })
  R2_thresholds_down_plot = R2_thresholds_down_plot[!is.na(R2_thresholds_down_plot)]
  
  R2_thresholds_down_plot = R2_thresholds_down_plot[intersect(names(R2_thresholds_down_plot), names(R2_thresholds_up_plot))]
  R2_thresholds_up_plot = R2_thresholds_up_plot[intersect(names(R2_thresholds_down_plot), names(R2_thresholds_up_plot))]
  R2_thresholds_up_plot = R2_thresholds_up_plot[intersect(names(R2_thresholds_up_plot), names(Market_Monthly_index))]
  R2_thresholds_down_plot = R2_thresholds_down_plot[names(R2_thresholds_up_plot)]
  Market_Monthly_index = Market_Monthly_index[names(R2_thresholds_up_plot)]
  market_index = 100*(1+cumprod(1+Market_Monthly))
  
  plot(R2_thresholds_up_plot, col="black", axes=FALSE, ylab="five-factor R square", main = "Buybacks Average five-factor R square", xlab = "Time",ylim=c(min(c(R2_thresholds_down_plot[!is.na(R2_thresholds_down_plot)],R2_thresholds_up_plot[!is.na(R2_thresholds_up_plot)])), max(c(R2_thresholds_down_plot[!is.na(R2_thresholds_down_plot)],R2_thresholds_up_plot[!is.na(R2_thresholds_up_plot)]))),  cex.lab=1.1, type="l", lwd=2)
  lines(R2_thresholds_down_plot, col="black", lwd=2,lty="dotted")
  axis(1,at=seq(1,length(Market_Monthly_index),length.out=20),labels=str_sub(names(Market_Monthly_index)[seq(1,length(Market_Monthly_index),length.out=20)], start=1,end=4),cex.axis=0.8,las=3)
  axis(2,cex.axis=1.1)
  #par(new = TRUE)
  #plot(market_index,type="l", lwd = 2, axes = FALSE, xlab = "", ylab = "")
  #axis(side=4, at = pretty(range(market_index)))
  #mtext("Market Index", side=4, line=3)
}
@
%\caption{Monthly average (across all buybacks events that month) $R^2$ defined using all buybacks events announced in a given month. Solid line is for high idiosyncratic events, dotted  line is for low. 
%Note that as the idiosyncratic risk is estimated using 6 months returns before announcement, there is a time shift relative to the market returns. 
%}
%\label{fig:R2thresholds}
%\end{figure}

%\clearpage


%\clearpage

%\begin{figure}[H]
%\centering
<< badpreviousR2, fig.width=10, fig.height=6, out.width='\\textwidth', echo=F >>=
#par(mfrow=c(2,1),mar=c(2.3,4,2.3,4))
if (0){
  plot(cumsum(100*High_Idiosyncr_BB_Hedged),type="l",ylab="CAR", xlab = "Time",main = "",  lwd=2, axes = FALSE, 
       ylim=c(min(c(cumsum(100*High_Idiosyncr_BB_Hedged),cumsum(100*Low_Idiosyncr_BB_Hedged),cumsum(100*High_Idiosyncr_BB_Hedged48m),cumsum(100*Low_Idiosyncr_BB_Hedged48m))), 
              max(c(cumsum(100*High_Idiosyncr_BB_Hedged),cumsum(100*Low_Idiosyncr_BB_Hedged),cumsum(100*High_Idiosyncr_BB_Hedged48m),cumsum(100*Low_Idiosyncr_BB_Hedged48m)))), cex.lab=1.1)
  axis(1,at=seq(1,length(High_Idiosyncr_BB_Hedged),length.out=10),labels=str_sub(names(High_Idiosyncr_BB_Hedged)[seq(1,length(High_Idiosyncr_BB_Hedged),length.out=10)], start = 1, end=4),cex.axis=0.8,las=3)
  axis(2,cex.axis=1.1)
  lines(cumsum(100*Low_Idiosyncr_BB_Hedged),lty="dotted", lwd=2)
  lines(cumsum(100*High_Idiosyncr_BB_Hedged48m),lty="dashed", lwd=2)
  lines(cumsum(100*Low_Idiosyncr_BB_Hedged48m),lty="dotdash", lwd=2)
  for (iter in 1:floor(100*max(c(cumsum(High_Idiosyncr_BB_Hedged),cumsum(Low_Idiosyncr_BB_Hedged)))/50))
    abline(h = 50*iter)
  abline(h = 200)
  #plot_crisis_dates(High_Idiosyncr_BB_Hedged)
  legend(x="topleft",
         c("12 Month High Idiosyncratic","12 Month Low Idiosyncratic","48 Month High Idiosyncratic","48 Month Low Idiosyncratic"),
         lty=c("solid","dotted","dashed","dotdash"),
         lwd=c(2,2,2,2),
         cex=1,bg="white",inset=0.01)
  
  if (0){
    plot(cumsum(100*High_Idiosyncr_ISS_Hedged),type="l",ylab="CAR", xlab = "Time",main = "SEOs", axes = FALSE, 
         ylim=c(min(c(cumsum(100*High_Idiosyncr_ISS_Hedged),cumsum(100*Low_Idiosyncr_ISS_Hedged),cumsum(100*High_Idiosyncr_ISS_Hedged48m),cumsum(100*Low_Idiosyncr_ISS_Hedged48m))), 
                max(c(cumsum(100*High_Idiosyncr_ISS_Hedged),cumsum(100*Low_Idiosyncr_ISS_Hedged),cumsum(100*High_Idiosyncr_ISS_Hedged48m),cumsum(100*Low_Idiosyncr_ISS_Hedged48m)))), cex.lab=1.1)
    axis(1,at=seq(1,length(High_Idiosyncr_ISS_Hedged),length.out=10),labels=str_sub(names(High_Idiosyncr_ISS_Hedged)[seq(1,length(High_Idiosyncr_ISS_Hedged),length.out=10)], start = 1, end=4),cex.axis=0.8,las=3)
    axis(2,cex.axis=1.1)
    lines(cumsum(100*Low_Idiosyncr_ISS_Hedged), col="red")
    lines(cumsum(100*High_Idiosyncr_ISS_Hedged48m), col="blue")
    lines(cumsum(100*Low_Idiosyncr_ISS_Hedged48m), col="green")
    for (iter in 1:floor(100*max(c(cumsum(High_Idiosyncr_ISS_Hedged),cumsum(Low_Idiosyncr_ISS_Hedged)))/50))
      abline(h = 50*iter)
    #plot_crisis_dates(High_Idiosyncr_ISS_Hedged)
  }
}
@
%\caption{Buybacks: High versus Low Idiosyncratic Events. Returns of five-factor rolling hedged portfolio for only the buyback events for high and low idiosyncratic company. Solid line is ``high'' and a 12-months holding portfolio, dotted line is ``low'' and a 12-months holding portfolio; dashed line is ``high'' and a 48-months holding portfolio, dotted-dash line is ``low'' and a 48-months portfolio. 
%Red line: average annual abnormal returns of \Sexpr{round(pnl_stats(Low_Idiosyncr_BB_Hedged)[1],1)}$\%$, Sharpe ratio of \Sexpr{round(pnl_stats(Low_Idiosyncr_BB_Hedged)[3],1)}. Black line: average annual abnormal returns of \Sexpr{round(pnl_stats(High_Idiosyncr_BB_Hedged)[1],1)}$\%$, Sharpe ratio of \Sexpr{round(pnl_stats(High_Idiosyncr_BB_Hedged)[3],1)}. Green line: average annual abnormal returns of \Sexpr{round(pnl_stats(Low_Idiosyncr_BB_Hedged48m)[1],1)}$\%$, Sharpe ratio of \Sexpr{round(pnl_stats(Low_Idiosyncr_BB_Hedged48m)[3],1)}. Blue line: average annual abnormal returns of \Sexpr{round(pnl_stats(High_Idiosyncr_BB_Hedged48m)[1],1)}$\%$, Sharpe ratio of \Sexpr{round(pnl_stats(High_Idiosyncr_BB_Hedged48m)[3],1)}. 
%We assume we enter each position \Sexpr{trading_day_after_announce} day after the corresponding event announcement. 
%Vertical lines indicate \Sexpr{BEAR_YEARS_text$dotcom[1]}, \Sexpr{BEAR_YEARS_text$dotcom[2]}, \Sexpr{BEAR_YEARS_text$financial1[1]}, and \Sexpr{BEAR_YEARS_text$financial1[2]}. 
%}
%\label{fig:badpreviousR2}
%\end{figure}


\begin{figure}[H]
\centering
<< fig.width=8, fig.height=5, out.width='\\textwidth', echo=F >>=
par(mfrow=c(2,2), mar=c(2.3,4,2.3,4))

R2_IRATStableBB_plot = R2_IRATStableBB
R2_IRATStableBB_plot[rownames(R2_IRATStableBB_plot) %in% as.character((-6):(-1)),c("Low Idiosync.: CAR","High Idiosync.: CAR")] <- -R2_IRATStableBB_plot[rownames(R2_IRATStableBB_plot) %in% as.character((-6):(-1)),c("Low Idiosync.: CAR","High Idiosync.: CAR")] 
R2_IRATStable_underBB_plot = R2_IRATStable_underBB
R2_IRATStable_underBB_plot[rownames(R2_IRATStable_underBB_plot) %in% as.character((-6):(-1)),c(1,4,7,10)] <- -R2_IRATStable_underBB_plot[rownames(R2_IRATStable_underBB_plot) %in% as.character((-6):(-1)),c(1,4,7,10)] 

ylimit = c(min(R2_IRATStableBB_plot[reported_times_plots,"High Idiosync.: CAR"], 
               R2_IRATStableBB_plot[reported_times_plots,"Low Idiosync.: CAR"],
               R2_IRATStable_underBB_plot[reported_times_plots,"Low Idiosync.: U CAR"],
               R2_IRATStable_underBB_plot[reported_times_plots,"High Idiosync.: U CAR"],
               R2_IRATStable_underBB_plot[reported_times_plots,4],
               R2_IRATStable_underBB_plot[reported_times_plots,10]), 
           max(R2_IRATStableBB_plot[reported_times_plots,"High Idiosync.: CAR"], 
               R2_IRATStableBB_plot[reported_times_plots,"Low Idiosync.: CAR"],
               R2_IRATStable_underBB_plot[reported_times_plots,"Low Idiosync.: U CAR"],
               R2_IRATStable_underBB_plot[reported_times_plots,"High Idiosync.: U CAR"],
               R2_IRATStable_underBB_plot[reported_times_plots,4],
               R2_IRATStable_underBB_plot[reported_times_plots,10]))

plot(R2_IRATStable_underBB_plot[reported_times_plots,"High Idiosync.: U CAR"], ylim = ylimit,axes=FALSE, type = "l", ylab = "CAR", xlab="Months",main="Panel A: High U-index buybacks", lwd=1.4)
axis(1,at=plot_tickers,labels=plot_xlabels,cex.axis=0.8,las=3)
axis(2,cex.axis=1.1)
lines(R2_IRATStable_underBB_plot[reported_times_plots,"Low Idiosync.: U CAR"],lty = 2,lwd=1.6)
abline(v=which(reported_times_plots == "0"), lwd=0.5)
abline(h=0, lwd=0.5)

plot(R2_IRATStable_underBB_plot[reported_times_plots,10], ylim = ylimit,axes=FALSE, type = "l", ylab = "CAR", xlab="Months",main="Panel B: Low U-index buybacks", lwd=1.4)
axis(1,at=plot_tickers,labels=plot_xlabels,cex.axis=0.8,las=3)
axis(2,cex.axis=1.1)
lines(R2_IRATStable_underBB_plot[reported_times_plots,4],lty = 2,lwd=1.6)
abline(v=which(reported_times_plots == "0"), lwd=0.5)
abline(h=0, lwd=0.5)

plot(R2_IRATStableBB_plot[reported_times_plots,"High Idiosync.: CAR"], ylim = ylimit,axes=FALSE, type = "l", ylab = "CAR", xlab="Months",main="Panel C: All buybacks", lwd=1.4)
axis(1,at=plot_tickers,labels=plot_xlabels,cex.axis=0.8,las=3)
axis(2,cex.axis=1.1)
lines(R2_IRATStableBB_plot[reported_times_plots,"Low Idiosync.: CAR"],  lty = 2,lwd=1.4)
abline(v=which(reported_times_plots == "0"), lwd=0.5)
abline(h=0, lwd=0.5)

@
\caption{Long-run five factors cumulative average abnormal returns (IRATS) of high (solid line) and low (dashed line) idiosyncratic buybacks. The x-axis indicates months from the date of the event announcement. Panel~A shows only the high  U-index companies, Panel~B  the low U-index ones, and bottom Panel C includes the whole sample.}
\label{fig:pastallidio}
\end{figure}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% VOL ANALYSIS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\clearpage
%\subsection{Volatility and Buybacks}
%\label{app:volatility}

%\begin{figure}[H]
%\centering
<< VOLthresholds, fig.width=7, fig.height=4, out.width='\\textwidth', echo=F >>=
#par(mfrow=c(2,1), mar=c(2.7,4.5,2.7,4.5))
if (0){
  Market_Monthly_index = Market_Monthly
  names(Market_Monthly_index) <- paste(str_sub(names(Market_Monthly_index),start=1,end=4),str_sub(names(Market_Monthly_index),start=6,end=7),sep="")
  
  all_dates = paste(str_sub((BUYBACK_DATA_NEW$DATASET$SDC$Event.Date),start=1,end=4),str_sub((BUYBACK_DATA_NEW$DATASET$SDC$Event.Date),start=6,end=7),sep="")[High_VOL_eventsBB]
  tmp = BUYBACK_DATA_NEW$DATASET$SDC$pre_vol[High_VOL_eventsBB]
  names(tmp)<-all_dates
  VOL_thresholds_up_plot = sapply(names(Market_Monthly_index), function(i){
    ifelse(sum(names(tmp) == i) > 1, mean(tmp[names(tmp) == i]),NA)
  })
  VOL_thresholds_up_plot = 100*VOL_thresholds_up_plot[!is.na(VOL_thresholds_up_plot)]
  all_dates = paste(str_sub((BUYBACK_DATA_NEW$DATASET$SDC$Event.Date),start=1,end=4),str_sub((BUYBACK_DATA_NEW$DATASET$SDC$Event.Date),start=6,end=7),sep="")[Low_VOL_eventsBB]
  tmp = BUYBACK_DATA_NEW$DATASET$SDC$pre_vol[Low_VOL_eventsBB]
  names(tmp)<-all_dates
  VOL_thresholds_down_plot = sapply(names(Market_Monthly_index), function(i){
    ifelse(sum(names(tmp) == i) > 1, mean(tmp[names(tmp) == i]),NA)
  })
  VOL_thresholds_down_plot = 100*VOL_thresholds_down_plot[!is.na(VOL_thresholds_down_plot)]
  
  VOL_thresholds_down_plot = VOL_thresholds_down_plot[intersect(names(VOL_thresholds_down_plot), names(VOL_thresholds_up_plot))]
  VOL_thresholds_up_plot = VOL_thresholds_up_plot[intersect(names(VOL_thresholds_down_plot), names(VOL_thresholds_up_plot))]
  VOL_thresholds_up_plot = VOL_thresholds_up_plot[intersect(names(VOL_thresholds_up_plot), names(Market_Monthly_index))]
  VOL_thresholds_down_plot = VOL_thresholds_down_plot[names(VOL_thresholds_up_plot)]
  Market_Monthly_index = Market_Monthly_index[names(VOL_thresholds_up_plot)]
  market_index = 100*(1+cumprod(1+Market_Monthly))
  
  plot(VOL_thresholds_up_plot, col="black", axes=FALSE, ylab="Average Volatility (percent)", main = "Buybacks pre-Announce Returns Volatility", xlab = "Time",ylim=c(min(c(VOL_thresholds_down_plot,VOL_thresholds_up_plot)), max(c(VOL_thresholds_down_plot,VOL_thresholds_up_plot))),  cex.lab=1.1, type="l", lwd=1.2)
  lines(VOL_thresholds_down_plot, col="black", lwd=2,lty="dotted")
  axis(1,at=seq(1,length(Market_Monthly_index),length.out=20),labels=str_sub(names(Market_Monthly_index)[seq(1,length(Market_Monthly_index),length.out=20)], start=1,end=4),cex.axis=0.8,las=3)
  axis(2,cex.axis=1.1)
  #par(new = TRUE)
  #plot(market_index,type="l", lwd = 2, axes = FALSE, xlab = "", ylab = "")
  #axis(side=4, at = pretty(range(market_index)))
  #mtext("Market Index", side=4, line=3)
}
@
%\caption{Monthly average (across all buybacks events that month) volatility (standard deviation of daily$\%$ returns over 6 months before announcement) defined using all buybacks events announced in a given month. Solid line is for high idiosyncratic events, dotted line is for low. 
%Note that as the volatility is estimated using 6 months returns before announcement, there is a time shift relative to the market returns.  
%}
%\label{fig:VOLthresholds}
%\end{figure}


%\begin{figure}[H]
%\centering
<< badpreviousVOL, fig.width=10, fig.height=6, out.width='\\textwidth', echo=F >>=
#par(mfrow=c(2,1),mar=c(2.3,4,2.3,4))
if (0){
  plot(cumsum(100*High_VOL_BB_Hedged),type="l",ylab="CAR", xlab = "Time",main = "", lwd=2, axes = FALSE, 
       ylim=c(min(c(cumsum(100*High_VOL_BB_Hedged),cumsum(100*Low_VOL_BB_Hedged),cumsum(100*High_VOL_BB_Hedged48m),cumsum(100*Low_VOL_BB_Hedged48m))), 
              max(c(cumsum(100*High_VOL_BB_Hedged),cumsum(100*Low_VOL_BB_Hedged),cumsum(100*High_VOL_BB_Hedged48m),cumsum(100*Low_VOL_BB_Hedged48m)))), cex.lab=1.1)
  axis(1,at=seq(1,length(High_VOL_BB_Hedged),length.out=10),labels=str_sub(names(High_VOL_BB_Hedged)[seq(1,length(High_VOL_BB_Hedged),length.out=10)], start = 1, end=4),cex.axis=0.8,las=3)
  axis(2,cex.axis=1.1)
  lines(cumsum(100*Low_VOL_BB_Hedged),lty="dotted", lwd=2)
  lines(cumsum(100*High_VOL_BB_Hedged48m),lty="dashed", lwd=2)
  lines(cumsum(100*Low_VOL_BB_Hedged48m),lty="dotdash", lwd=2)
  for (iter in 1:floor(100*max(c(cumsum(High_VOL_BB_Hedged),cumsum(Low_VOL_BB_Hedged)))/50))
    abline(h = 50*iter)
  #plot_crisis_dates(High_VOL_BB_Hedged)
  legend(x="topleft",
         c("12 Month High Volatility","12 Month Low Volatility","48 Month High Volatility","48 Month Low Volatility"),
         lty=c("solid","dotted","dashed","dotdash"),
         lwd=c(2,2,2,2),
         cex=1,bg="white",inset=0.01)
  
  if (0){
    plot(cumsum(100*High_VOL_ISS_Hedged),type="l",ylab="CAR", xlab = "Time",main = "SEOs", lwd=2, axes = FALSE, 
         ylim=c(min(c(cumsum(100*High_VOL_ISS_Hedged),cumsum(100*Low_VOL_ISS_Hedged),cumsum(100*High_VOL_ISS_Hedged48m),cumsum(100*Low_VOL_ISS_Hedged48m))), 
                max(c(cumsum(100*High_VOL_ISS_Hedged),cumsum(100*Low_VOL_ISS_Hedged),cumsum(100*High_VOL_ISS_Hedged48m),cumsum(100*Low_VOL_ISS_Hedged48m)))), cex.lab=1.1)
    axis(1,at=seq(1,length(High_VOL_ISS_Hedged),length.out=10),labels=str_sub(names(High_VOL_ISS_Hedged)[seq(1,length(High_VOL_ISS_Hedged),length.out=10)], start = 1, end=4),cex.axis=0.8,las=3)
    axis(2,cex.axis=1.1)
    lines(cumsum(100*Low_VOL_ISS_Hedged),lty="dotted", lwd=2)
    lines(cumsum(100*High_VOL_ISS_Hedged48m),lty="dashed", lwd=2)
    lines(cumsum(100*Low_VOL_ISS_Hedged48m),lty="dotdash", lwd=2)
    for (iter in 1:floor(100*max(c(cumsum(High_VOL_ISS_Hedged),cumsum(Low_VOL_ISS_Hedged)))/50))
      abline(h = 50*iter)
    #plot_crisis_dates(High_VOL_ISS_Hedged)
  }
}
@
%\caption{Buybacks: High vs Low Volatility Events. Returns of five-factor rolling hedged portfolio for only the buyback events for high and low volatility company. Solid line is ``high'' and a 12-months holding portfolio, dotted line is ``low'' and a 12-months holding portfolio; dashed line is ``high'' and a 48-months holding portfolio, dotted-dash line is ``low'' and a 48-months portfolio. 
%Red line: average annual abnormal returns of \Sexpr{round(pnl_stats(Low_VOL_BB_Hedged)[1],1)}$\%$, Sharpe ratio of \Sexpr{round(pnl_stats(Low_VOL_BB_Hedged)[3],1)}. Black line: average annual abnormal returns of \Sexpr{round(pnl_stats(High_VOL_BB_Hedged)[1],1)}$\%$, Sharpe ratio of \Sexpr{round(pnl_stats(High_VOL_BB_Hedged)[3],1)}. Green line: average annual abnormal returns of \Sexpr{round(pnl_stats(Low_VOL_BB_Hedged48m)[1],1)}$\%$, Sharpe ratio of \Sexpr{round(pnl_stats(Low_VOL_BB_Hedged48m)[3],1)}. Blue line: average annual abnormal returns of \Sexpr{round(pnl_stats(High_VOL_BB_Hedged48m)[1],1)}$\%$, Sharpe ratio of \Sexpr{round(pnl_stats(High_VOL_BB_Hedged48m)[3],1)}. 
%We assume we enter each position \Sexpr{trading_day_after_announce} day after the corresponding event announcement. 
%Vertical lines indicate \Sexpr{BEAR_YEARS_text$dotcom[1]}, \Sexpr{BEAR_YEARS_text$dotcom[2]}, \Sexpr{BEAR_YEARS_text$financial1[1]}, and \Sexpr{BEAR_YEARS_text$financial1[2]}. 
%}
%\label{fig:badpreviousVOL}
%\end{figure}


\begin{figure}[H]
\centering
<< fig.width=8, fig.height=5, out.width='\\textwidth', echo=F >>=
par(mfrow=c(2,2), mar=c(2.3,4,2.3,4))

VOL_IRATStableBB_plot = VOL_IRATStableBB
VOL_IRATStableBB_plot[rownames(VOL_IRATStableBB_plot) %in% as.character((-6):(-1)),c("Low Vol: CAR","High Vol: CAR")] <- -VOL_IRATStableBB_plot[rownames(VOL_IRATStableBB_plot) %in% as.character((-6):(-1)),c("Low Vol: CAR","High Vol: CAR")] 
VOL_IRATStable_underBB_plot = VOL_IRATStable_underBB
VOL_IRATStable_underBB_plot[rownames(VOL_IRATStable_underBB_plot) %in% as.character((-6):(-1)),c(1,4,7,10)] <- -VOL_IRATStable_underBB_plot[rownames(VOL_IRATStable_underBB_plot) %in% as.character((-6):(-1)),c(1,4,7,10)] 

ylimit = c(min(VOL_IRATStableBB_plot[reported_times_plots,"High Vol: CAR"], 
               VOL_IRATStableBB_plot[reported_times_plots,"Low Vol: CAR"],
               VOL_IRATStable_underBB_plot[reported_times_plots,"Low Vol: U CAR"],
               VOL_IRATStable_underBB_plot[reported_times_plots,"High Vol: U CAR"],
               VOL_IRATStable_underBB_plot[reported_times_plots,4],
               VOL_IRATStable_underBB_plot[reported_times_plots,10]), 
           max(VOL_IRATStableBB_plot[reported_times_plots,"High Vol: CAR"], 
               VOL_IRATStableBB_plot[reported_times_plots,"Low Vol: CAR"],
               VOL_IRATStable_underBB_plot[reported_times_plots,"Low Vol: U CAR"],
               VOL_IRATStable_underBB_plot[reported_times_plots,"High Vol: U CAR"],
               VOL_IRATStable_underBB_plot[reported_times_plots,4],
               VOL_IRATStable_underBB_plot[reported_times_plots,10]))

plot(VOL_IRATStable_underBB_plot[reported_times_plots,"High Vol: U CAR"], ylim = ylimit,axes=FALSE, type = "l", ylab = "CAR", xlab="Months",main="Panel A: High U-index buybacks", lwd=1.4)
axis(1,at=plot_tickers,labels=plot_xlabels,cex.axis=0.8,las=3)
axis(2,cex.axis=1.1)
lines(VOL_IRATStable_underBB_plot[reported_times_plots,"Low Vol: U CAR"],lty = 2,lwd=1.6)
abline(v=which(reported_times_plots == "0"), lwd=0.5)
abline(h=0, lwd=0.5)

plot(VOL_IRATStable_underBB_plot[reported_times_plots,10], ylim = ylimit,axes=FALSE, type = "l", ylab = "CAR", xlab="Months",main="Panel B: Low U-index buybacks", lwd=1.4)
axis(1,at=plot_tickers,labels=plot_xlabels,cex.axis=0.8,las=3)
axis(2,cex.axis=1.1)
lines(VOL_IRATStable_underBB_plot[reported_times_plots,4],lty = 2,lwd=1.6)
abline(v=which(reported_times_plots == "0"), lwd=0.5)
abline(h=0, lwd=0.5)

plot(VOL_IRATStableBB_plot[reported_times_plots,"High Vol: CAR"], ylim = ylimit,axes=FALSE, type = "l", ylab = "CAR", xlab="Months",main="Panel C: All buybacks", lwd=1.4)
axis(1,at=plot_tickers,labels=plot_xlabels,cex.axis=0.8,las=3)
axis(2,cex.axis=1.1)
lines(VOL_IRATStableBB_plot[reported_times_plots,"Low Vol: CAR"],  lty = 2,lwd=1.4)
abline(v=which(reported_times_plots == "0"), lwd=0.5)
abline(h=0, lwd=0.5)

@
\caption{Volatility and the U-index. Long-run five factors cumulative average abnormal returns (IRATS) of high (solid line) and low (dashed line) volatility buybacks. The x-axis indicates months from the date of the event announcement. Panel~A shows only the high  U-index companies, Panel~B  the low U-index ones, and bottom Panel C includes the whole sample.}
\label{fig:pastallVOL}
\end{figure}

\clearpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% NEW INDEX
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\clearpage

\begin{figure}[H]
\centering
<< fig.width=10, fig.height=4, out.width='\\textwidth', echo=F >>=
#par(mfrow=c(2,1), mar=c(2.3,4,2.3,4))
#valuation_index_bb[which(valuation_index_bb==2)]<-3 # there is one company here. need to check why
tmp = table(EUindex_bb)
tmp = structure(as.numeric(tmp), .Names = names(tmp))
barplot(tmp,main = "", ylab = "Number of Announcements", xlab = "",las=2,space=0.5, cex.names=0.8)
#tmp = table(valuation_index_iss)
#tmp = structure(as.numeric(tmp), .Names = names(tmp))
#barplot(tmp,main = "SEOs", ylab = "Number of Announcements", xlab = "SEO Overvaluation Index",las=2,space=0.5, cex.names=0.8)
rm("tmp")
@
\caption{EU-index. Distribution of the EU-index of all buyback events.}
\label{fig:Eundervaluationindex}
\end{figure}


%\begin{figure}[H]
%\centering
<< badpreviousEU, fig.width=10, fig.height=6, out.width='\\textwidth', echo=F >>=
if (0){
  #par(mfrow=c(2,1),mar=c(2.3,4,2.3,4))
  plot(cumsum(100*High_EU_BB_Hedged),type="l",ylab="CAR", xlab = "Time",main = "", lwd=2, axes = FALSE, 
       ylim=c(min(c(cumsum(100*High_EU_BB_Hedged),cumsum(100*Low_EU_BB_Hedged),cumsum(100*High_EU_BB_Hedged48m),cumsum(100*Low_EU_BB_Hedged48m))), 
              max(c(cumsum(100*High_EU_BB_Hedged),cumsum(100*Low_EU_BB_Hedged),cumsum(100*High_EU_BB_Hedged48m),cumsum(100*Low_EU_BB_Hedged48m)))), cex.lab=1.1)
  axis(1,at=seq(1,length(High_EU_BB_Hedged),length.out=10),labels=str_sub(names(High_EU_BB_Hedged)[seq(1,length(High_EU_BB_Hedged),length.out=10)], start = 1, end=4),cex.axis=0.8,las=3)
  axis(2,cex.axis=1.1)
  lines(cumsum(100*Low_EU_BB_Hedged),lty="dotted", lwd=2)
  lines(cumsum(100*High_EU_BB_Hedged48m),lty="dashed", lwd=2)
  lines(cumsum(100*Low_EU_BB_Hedged48m),lty="dotdash", lwd=2)
  for (iter in 1:floor(100*max(c(cumsum(High_EU_BB_Hedged),cumsum(Low_EU_BB_Hedged)))/50))
    abline(h = 50*iter)
  #plot_crisis_dates(High_EU_BB_Hedged)
  legend(x="topleft",
         c("12 Month High EU","12 Month Low EU","48 Month High EU","48 Month Low EU"),
         lty=c("solid","dotted","dashed","dotdash"),
         lwd=c(2,2,2,2),
         cex=1,bg="white",inset=0.01)
  
  if (0){
    plot(cumsum(100*High_EU_ISS_Hedged),type="l",ylab="CAR", xlab = "Time",main = "SEOs", axes = FALSE, 
         ylim=c(min(c(cumsum(100*High_EU_ISS_Hedged),cumsum(100*Low_EU_ISS_Hedged),cumsum(100*High_EU_ISS_Hedged48m),cumsum(100*Low_EU_ISS_Hedged48m))), 
                max(c(cumsum(100*High_EU_ISS_Hedged),cumsum(100*Low_EU_ISS_Hedged),cumsum(100*High_EU_ISS_Hedged48m),cumsum(100*Low_EU_ISS_Hedged48m)))), cex.lab=1.1)
    axis(1,at=seq(1,length(High_EU_ISS_Hedged),length.out=10),labels=str_sub(names(High_EU_ISS_Hedged)[seq(1,length(High_EU_ISS_Hedged),length.out=10)], start = 1, end=4),cex.axis=0.8,las=3)
    axis(2,cex.axis=1.1)
    lines(cumsum(100*Low_EU_ISS_Hedged), col="red")
    lines(cumsum(100*High_EU_ISS_Hedged48m), col="blue")
    lines(cumsum(100*Low_EU_ISS_Hedged48m), col="green")
    for (iter in 1:floor(100*max(c(cumsum(High_EU_ISS_Hedged),cumsum(Low_VOL_ISS_Hedged)))/50))
      abline(h = 50*iter)
    #plot_crisis_dates(High_VOL_ISS_Hedged)
  }
}
@
%\caption{Buybacks: High vs Low EU-index Events. Returns of five-factor rolling hedged portfolio for only the buyback events for high and low EU-index companies.  We define low EU-index firms those for which the EU-index is 0-1, and high for which it is 5-6 (note that the index takes values from 0 to 6).  Solid line is ``high'' and a 12-months holding portfolio, dotted line is ``low'' and a 12-months holding portfolio; dashed line is ``high'' and a 48-months holding portfolio, dotted-dash line is ``low'' and a 48-months portfolio.
%Red line: average annual abnormal returns of \Sexpr{round(pnl_stats(Low_EU_BB_Hedged)[1],1)}$\%$, Sharpe ratio of \Sexpr{round(pnl_stats(Low_EU_BB_Hedged)[3],1)}. Black line: average annual abnormal returns of \Sexpr{round(pnl_stats(High_EU_BB_Hedged)[1],1)}$\%$, Sharpe ratio of \Sexpr{round(pnl_stats(High_EU_BB_Hedged)[3],1)}. Green line: average annual abnormal returns of \Sexpr{round(pnl_stats(Low_EU_BB_Hedged48m)[1],1)}$\%$, Sharpe ratio of \Sexpr{round(pnl_stats(Low_EU_BB_Hedged48m)[3],1)}. Blue line: average annual abnormal returns of \Sexpr{round(pnl_stats(High_EU_BB_Hedged48m)[1],1)}$\%$, Sharpe ratio of \Sexpr{round(pnl_stats(High_EU_BB_Hedged48m)[3],1)}. 
%We assume we enter each position \Sexpr{trading_day_after_announce} day after the corresponding event announcement. 
%Vertical lines indicate \Sexpr{BEAR_YEARS_text$dotcom[1]}, \Sexpr{BEAR_YEARS_text$dotcom[2]}, \Sexpr{BEAR_YEARS_text$financial1[1]}, and \Sexpr{BEAR_YEARS_text$financial1[2]}. 
%}
%\label{fig:badpreviousEU}
%\end{figure}

\begin{figure}[H]
\centering
<< fig.width=10, fig.height=6, out.width='\\textwidth', echo=F >>= 
IRATS_table_all_bb_plot = EU_IRATStable_bb
IRATS_table_all_bb_plot[rownames(IRATS_table_all_bb_plot) %in% as.character((-6):(-1)),which(colnames(IRATS_table_all_bb_plot)=="CAR")] <- -IRATS_table_all_bb_plot[rownames(IRATS_table_all_bb_plot) %in% as.character((-6):(-1)),which(colnames(IRATS_table_all_bb_plot)=="CAR")] 

ylimit = c(min(as.vector(IRATS_table_all_bb_plot[reported_times_plots,which(colnames(IRATS_table_all_bb_plot)=="CAR")])), max(as.vector(IRATS_table_all_bb_plot[reported_times_plots,which(colnames(IRATS_table_all_bb_plot)=="CAR")])))

plot(IRATS_table_all_bb_plot[reported_times_plots,3*6+1], ylim = ylimit,axes=FALSE, type = "l", ylab = "CAR", xlab="Months",main="Buybacks - EU index", lwd=2, lty = "solid")
axis(1,at=plot_tickers,labels=plot_xlabels,cex.axis=0.8,las=3)
axis(2,cex.axis=1.1)

lines(IRATS_table_all_bb_plot[reported_times_plots,1],lwd = 2, lty="dotted")
lines(IRATS_table_all_bb_plot[reported_times_plots,3*1+1],lwd = 2, lty="dotted")
tmp = IRATS_table_all_bb_plot[reported_times_plots,3*1+1]
tmp[c(3*(1:floor(length(tmp)/3)),3*(1:floor(length(tmp)/3))+1)] <- NA
points(tmp, pch=23,lwd=1)

lines(IRATS_table_all_bb_plot[reported_times_plots,3*2+1],lwd = 2, lty="dashed")
lines(IRATS_table_all_bb_plot[reported_times_plots,3*3+1],lwd = 2, lty="dashed")
tmp = IRATS_table_all_bb_plot[reported_times_plots,3*3+1]
tmp[c(3*(1:floor(length(tmp)/3)),3*(1:floor(length(tmp)/3))+1)] <- NA
points(tmp, pch=23,lwd=1)

lines(IRATS_table_all_bb_plot[reported_times_plots,3*4+1],lwd = 2, lty="dotdash")

lines(IRATS_table_all_bb_plot[reported_times_plots,3*5+1],lwd = 2, lty="solid")
tmp = IRATS_table_all_bb_plot[reported_times_plots,3*5+1]
tmp[c(3*(1:floor(length(tmp)/3)),3*(1:floor(length(tmp)/3))+1)] <- NA
points(tmp, pch=23,lwd=1)

abline(v=which(reported_times_plots == "0"), lwd=0.5)
abline(h=0, lwd=0.5)


legend(x="topleft",
       title="EU index value",
       legend = c("6","5","4","3","2","1","0"),
       lty=c("solid","solid","dotdash","dashed","dashed","dotted","dotted"),
       lwd=c(2,2,2,2,2,2),
       pch=c(NaN,23,NaN,23,NaN,23),
       cex=1,bg="white",inset=0.01)

@
\caption{Long-run IRATS five factors cumulative abnormal returns of buybacks depending on the EU-index. From the highest to the lowest lines: solid line is for EU-index 6, solid with diamonds for EU index 5, dotted-dashed for EU index 4, dashed with diamonds for EU index 3, dashed for EU index 2, dotted with diamonds for EU index 1, and finally the lowest dotted line is for EU index 0. The x-axis indicates months from the date of the event announcement.}
\label{fig:Epastall}
\end{figure}


%#######################################################################
%## REPORT.RNW SPECIAL CODE:
%########################################################################################################

\begin{figure}[H]
\centering
<< fig.width=10, fig.height=4, out.width='\\textwidth', echo=F >>=
tmp = table(secU$Index_score)
tmp = structure(as.numeric(tmp), .Names = names(tmp))
barplot(tmp,main = "", ylab = "Number of Announcements", xlab = "",las=2,space=0.5, cex.names=0.8)
rm("tmp")
@
\caption{CEU-index. Distribution of the CEU-index of all buyback events.}
\label{fig:CEundervaluationindex}
\end{figure}

\begin{figure}[H]
\centering
<< fig.width=10, fig.height=6, out.width='\\textwidth', echo=F >>=
IRATS_table_all_bb_plot = secU$CEU_IRATStable_bb
IRATS_table_all_bb_plot[rownames(IRATS_table_all_bb_plot) %in% as.character((-6):(-1)),which(colnames(IRATS_table_all_bb_plot)=="CAR")] <- -IRATS_table_all_bb_plot[rownames(IRATS_table_all_bb_plot) %in% as.character((-6):(-1)),which(colnames(IRATS_table_all_bb_plot)=="CAR")] 

ylimit = c(min(as.vector(IRATS_table_all_bb_plot[reported_times_plots,which(colnames(IRATS_table_all_bb_plot)=="CAR")])), max(as.vector(IRATS_table_all_bb_plot[reported_times_plots,which(colnames(IRATS_table_all_bb_plot)=="CAR")])))

#plot maximal first
plot(IRATS_table_all_bb_plot[reported_times_plots,dim(IRATS_table_all_bb_plot)[2]-2], ylim = ylimit,axes=FALSE, type = "l", ylab = "CAR", xlab="Months",main="Buybacks - CEU index", lwd=1, lty = "solid")
axis(1,at=plot_tickers,labels=plot_xlabels,cex.axis=0.8,las=3)
axis(2,cex.axis=1.1)

#now others
linestyle  = c("solid","dotted","dotted","dashed","dashed","dotdash","solid")
withpoints = c(F,    F,        T      ,F       ,T       ,F        ,T      )

theindex = rev(1:(dim(IRATS_table_all_bb_plot)[2]/3))
for(i in 1:length(theindex)) {
  lines(IRATS_table_all_bb_plot[reported_times_plots,3*(theindex[i]-1)+1],lwd = 2, lty=linestyle[i])
  if(withpoints[i]) {
    tmp = IRATS_table_all_bb_plot[reported_times_plots,3*(theindex[i]-1)+1]
    tmp[c(3*(1:floor(length(tmp)/3)),3*(1:floor(length(tmp)/3))+1)] <- NA
    points(tmp, pch=23,lwd=1)
  }
}

abline(v=which(reported_times_plots == "0"), lwd=0.5)
abline(h=0, lwd=0.5)

pchs = withpoints[1:length(theindex)]
pchs[pchs] = 23
pchs[!pchs] = NA
legend(x="topleft",
       title="CEU index value",
       legend = theindex,
       lty=linestyle[1:length(theindex)],
       lwd=(1:length(theindex))*0+2,
       pch=pchs,
       cex=1,bg="white",inset=0.01)
@
\caption{Long-run IRATS five factors cumulative abnormal returns of buybacks depending on the CEU-index. From the highest to the lowest lines as indicated by the legend. The x-axis indicates months from the date of the event announcement.}
\label{fig:CEpastall}
\end{figure}

This document took \Sexpr{toc()$tic/1000} seconds to produce.
%########################################################################################################
%## REPORT.RNW SPECIAL CODE ENDS HERE
%########################################################################################################

\end{document}


